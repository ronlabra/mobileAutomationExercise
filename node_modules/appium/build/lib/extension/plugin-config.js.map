{"version":3,"file":"plugin-config.js","names":["PluginConfig","ExtensionConfig","_instances","WeakMap","constructor","manifest","PLUGIN_TYPE","validate","_validate","getExtensionData","create","instance","getInstance","Error","appiumHome","set","get","extensionDesc","pluginName","version","print","activeNames","pluginNames","Object","keys","installedExtensions","_","isEmpty","log","info","pluginData","toPairs","activeTxt","includes"],"sources":["../../../lib/extension/plugin-config.js"],"sourcesContent":["import _ from 'lodash';\nimport {ExtensionConfig} from './extension-config';\nimport log from '../logger';\nimport {PLUGIN_TYPE} from '../constants';\n\n/**\n * @extends {ExtensionConfig<PluginType>}\n */\nexport class PluginConfig extends ExtensionConfig {\n  /**\n   * A mapping of {@link Manifest} instances to {@link PluginConfig} instances.\n   *\n   * `Manifest` and {@link ExtensionConfig} have a one-to-many relationship; each `Manifest` should be associated with a `DriverConfig` and a `PluginConfig`; no more, no less.\n   *\n   * This variable tracks the `Manifest`-to-`PluginConfig` portion.\n   *\n   * @type {WeakMap<Manifest,PluginConfig>}\n   * @private\n   */\n  static _instances = new WeakMap();\n\n  /**\n   * Call {@link PluginConfig.create} instead.\n   *\n   * Just calls the superclass' constructor with the correct extension type\n   * @private\n   * @param {Manifest} manifest - IO object\n   */\n  constructor(manifest) {\n    super(PLUGIN_TYPE, manifest);\n  }\n\n  async validate() {\n    return await super._validate(this.manifest.getExtensionData(PLUGIN_TYPE));\n  }\n\n  /**\n   * Creates a new {@link PluginConfig} instance for a {@link Manifest} instance.\n   *\n   * @param {Manifest} manifest\n   * @throws If `manifest` already associated with a `PluginConfig`\n   * @returns {PluginConfig}\n   */\n  static create(manifest) {\n    const instance = new PluginConfig(manifest);\n    if (PluginConfig.getInstance(manifest)) {\n      throw new Error(\n        `Manifest with APPIUM_HOME ${manifest.appiumHome} already has a PluginConfig; use PluginConfig.getInstance() to retrieve it.`\n      );\n    }\n    PluginConfig._instances.set(manifest, instance);\n    return instance;\n  }\n\n  /**\n   * Returns a PluginConfig associated with a Manifest\n   * @param {Manifest} manifest\n   * @returns {PluginConfig|undefined}\n   */\n  static getInstance(manifest) {\n    return PluginConfig._instances.get(manifest);\n  }\n\n  /**\n   * @param {string} pluginName\n   * @param {import('appium/types').ExtManifest<PluginType>} pluginData\n   * @returns {string}\n   */\n  extensionDesc(pluginName, {version}) {\n    return `${pluginName}@${version}`;\n  }\n\n  /**\n   *\n   * @param {(keyof PluginRecord)[]} activeNames\n   * @returns {void}\n   */\n  print(activeNames) {\n    const pluginNames = Object.keys(this.installedExtensions);\n\n    if (_.isEmpty(pluginNames)) {\n      log.info(\n        `No plugins have been installed. Use the \"appium plugin\" ` +\n          'command to install the one(s) you want to use.'\n      );\n      return;\n    }\n\n    log.info(`Available plugins:`);\n    for (const [pluginName, pluginData] of _.toPairs(this.installedExtensions)) {\n      const activeTxt = _.includes(activeNames, pluginName) ? ' (ACTIVE)' : '';\n      log.info(`  - ${this.extensionDesc(pluginName, pluginData)}${activeTxt}`);\n    }\n\n    if (_.isEmpty(activeNames)) {\n      log.info(\n        'No plugins activated. Use the --use-plugins flag with names of plugins to activate'\n      );\n    }\n  }\n}\n\n/**\n * @typedef PluginConfigOptions\n * @property {import('./extension-config').ExtensionLogFn} [logFn] - Optional logging function\n */\n\n/**\n * @typedef {import('appium/types').PluginRecord} PluginRecord\n * @typedef {import('@appium/types').PluginType} PluginType\n * @typedef {import('appium/types').ExtMetadata<PluginType>} PluginMetadata\n * @typedef {import('./manifest').Manifest} Manifest\n */\n"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAKO,MAAMA,YAAN,SAA2BC,gCAA3B,CAA2C;EAW/B,OAAVC,UAAU,GAAG,IAAIC,OAAJ,EAAH;;EASjBC,WAAW,CAACC,QAAD,EAAW;IACpB,MAAMC,sBAAN,EAAmBD,QAAnB;EACD;;EAEa,MAARE,QAAQ,GAAG;IACf,OAAO,MAAM,MAAMC,SAAN,CAAgB,KAAKH,QAAL,CAAcI,gBAAd,CAA+BH,sBAA/B,CAAhB,CAAb;EACD;;EASY,OAANI,MAAM,CAACL,QAAD,EAAW;IACtB,MAAMM,QAAQ,GAAG,IAAIX,YAAJ,CAAiBK,QAAjB,CAAjB;;IACA,IAAIL,YAAY,CAACY,WAAb,CAAyBP,QAAzB,CAAJ,EAAwC;MACtC,MAAM,IAAIQ,KAAJ,CACH,6BAA4BR,QAAQ,CAACS,UAAW,6EAD7C,CAAN;IAGD;;IACDd,YAAY,CAACE,UAAb,CAAwBa,GAAxB,CAA4BV,QAA5B,EAAsCM,QAAtC;;IACA,OAAOA,QAAP;EACD;;EAOiB,OAAXC,WAAW,CAACP,QAAD,EAAW;IAC3B,OAAOL,YAAY,CAACE,UAAb,CAAwBc,GAAxB,CAA4BX,QAA5B,CAAP;EACD;;EAODY,aAAa,CAACC,UAAD,EAAa;IAACC;EAAD,CAAb,EAAwB;IACnC,OAAQ,GAAED,UAAW,IAAGC,OAAQ,EAAhC;EACD;;EAODC,KAAK,CAACC,WAAD,EAAc;IACjB,MAAMC,WAAW,GAAGC,MAAM,CAACC,IAAP,CAAY,KAAKC,mBAAjB,CAApB;;IAEA,IAAIC,eAAA,CAAEC,OAAF,CAAUL,WAAV,CAAJ,EAA4B;MAC1BM,eAAA,CAAIC,IAAJ,CACG,0DAAD,GACE,gDAFJ;;MAIA;IACD;;IAEDD,eAAA,CAAIC,IAAJ,CAAU,oBAAV;;IACA,KAAK,MAAM,CAACX,UAAD,EAAaY,UAAb,CAAX,IAAuCJ,eAAA,CAAEK,OAAF,CAAU,KAAKN,mBAAf,CAAvC,EAA4E;MAC1E,MAAMO,SAAS,GAAGN,eAAA,CAAEO,QAAF,CAAWZ,WAAX,EAAwBH,UAAxB,IAAsC,WAAtC,GAAoD,EAAtE;;MACAU,eAAA,CAAIC,IAAJ,CAAU,OAAM,KAAKZ,aAAL,CAAmBC,UAAnB,EAA+BY,UAA/B,CAA2C,GAAEE,SAAU,EAAvE;IACD;;IAED,IAAIN,eAAA,CAAEC,OAAF,CAAUN,WAAV,CAAJ,EAA4B;MAC1BO,eAAA,CAAIC,IAAJ,CACE,oFADF;IAGD;EACF;;AA3F+C"}