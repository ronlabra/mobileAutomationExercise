{"version":3,"file":"driver-command.js","names":["REQ_DRIVER_FIELDS","DriverCommand","ExtensionCommand","constructor","config","json","knownExtensions","KNOWN_DRIVERS","install","driver","installType","packageName","_install","installSpec","uninstall","_uninstall","update","unsafe","_update","run","scriptName","extraArgs","_run","getPostInstallText","extName","extData","version","green","automationName","JSON","stringify","platformNames","validateExtensionFields","driverMetadata","missingFields","reduce","acc","field","_","isEmpty","Error"],"sources":["../../../lib/cli/driver-command.js"],"sourcesContent":["import _ from 'lodash';\nimport ExtensionCommand from './extension-command';\nimport {KNOWN_DRIVERS} from '../constants';\nimport '@colors/colors';\n\nconst REQ_DRIVER_FIELDS = ['driverName', 'automationName', 'platformNames', 'mainClass'];\n\n/**\n * @extends {ExtensionCommand<DriverType>}\n */\nexport default class DriverCommand extends ExtensionCommand {\n  /**\n   * @param {import('./extension-command').ExtensionCommandOptions<DriverType>} opts\n   */\n  constructor({config, json}) {\n    super({config, json});\n    this.knownExtensions = KNOWN_DRIVERS;\n  }\n\n  async install({driver, installType, packageName}) {\n    return await super._install({\n      installSpec: driver,\n      installType,\n      packageName,\n    });\n  }\n\n  async uninstall({driver}) {\n    return await super._uninstall({installSpec: driver});\n  }\n\n  async update({driver, unsafe}) {\n    return await super._update({installSpec: driver, unsafe});\n  }\n\n  async run({driver, scriptName, extraArgs}) {\n    return await super._run({installSpec: driver, scriptName, extraArgs});\n  }\n\n  getPostInstallText({extName, extData}) {\n    return (\n      `Driver ${extName}@${extData.version} successfully installed\\n`.green +\n      `- automationName: ${extData.automationName.green}\\n` +\n      `- platformNames: ${JSON.stringify(extData.platformNames).green}`\n    );\n  }\n\n  /**\n   * Validates fields in `appium` field of `driverMetadata`\n   *\n   * For any `package.json` fields which a driver requires, validate the type of\n   * those fields on the `package.json` data, throwing an error if anything is\n   * amiss.\n   * @param {import('appium/types').ExtMetadata<DriverType>} driverMetadata\n   * @param {string} installSpec\n   */\n  validateExtensionFields(driverMetadata, installSpec) {\n    const missingFields = REQ_DRIVER_FIELDS.reduce(\n      (acc, field) => (driverMetadata[field] ? acc : [...acc, field]),\n      []\n    );\n\n    if (!_.isEmpty(missingFields)) {\n      throw new Error(\n        `Driver \"${installSpec}\" did not expose correct fields for compability ` +\n          `with Appium. Missing fields: ${JSON.stringify(missingFields)}`\n      );\n    }\n  }\n}\n\n/**\n * @typedef DriverCommandOptions\n * @property {import('../extension/extension-config').ExtensionConfig<DriverType>} config\n * @property {boolean} json\n */\n\n/**\n * @typedef {import('@appium/types').DriverType} DriverType\n */\n"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAEA,MAAMA,iBAAiB,GAAG,CAAC,YAAD,EAAe,gBAAf,EAAiC,eAAjC,EAAkD,WAAlD,CAA1B;;AAKe,MAAMC,aAAN,SAA4BC,yBAA5B,CAA6C;EAI1DC,WAAW,CAAC;IAACC,MAAD;IAASC;EAAT,CAAD,EAAiB;IAC1B,MAAM;MAACD,MAAD;MAASC;IAAT,CAAN;IACA,KAAKC,eAAL,GAAuBC,wBAAvB;EACD;;EAEY,MAAPC,OAAO,CAAC;IAACC,MAAD;IAASC,WAAT;IAAsBC;EAAtB,CAAD,EAAqC;IAChD,OAAO,MAAM,MAAMC,QAAN,CAAe;MAC1BC,WAAW,EAAEJ,MADa;MAE1BC,WAF0B;MAG1BC;IAH0B,CAAf,CAAb;EAKD;;EAEc,MAATG,SAAS,CAAC;IAACL;EAAD,CAAD,EAAW;IACxB,OAAO,MAAM,MAAMM,UAAN,CAAiB;MAACF,WAAW,EAAEJ;IAAd,CAAjB,CAAb;EACD;;EAEW,MAANO,MAAM,CAAC;IAACP,MAAD;IAASQ;EAAT,CAAD,EAAmB;IAC7B,OAAO,MAAM,MAAMC,OAAN,CAAc;MAACL,WAAW,EAAEJ,MAAd;MAAsBQ;IAAtB,CAAd,CAAb;EACD;;EAEQ,MAAHE,GAAG,CAAC;IAACV,MAAD;IAASW,UAAT;IAAqBC;EAArB,CAAD,EAAkC;IACzC,OAAO,MAAM,MAAMC,IAAN,CAAW;MAACT,WAAW,EAAEJ,MAAd;MAAsBW,UAAtB;MAAkCC;IAAlC,CAAX,CAAb;EACD;;EAEDE,kBAAkB,CAAC;IAACC,OAAD;IAAUC;EAAV,CAAD,EAAqB;IACrC,OACG,UAASD,OAAQ,IAAGC,OAAO,CAACC,OAAQ,2BAArC,CAAgEC,KAAhE,GACC,qBAAoBF,OAAO,CAACG,cAAR,CAAuBD,KAAM,IADlD,GAEC,oBAAmBE,IAAI,CAACC,SAAL,CAAeL,OAAO,CAACM,aAAvB,EAAsCJ,KAAM,EAHlE;EAKD;;EAWDK,uBAAuB,CAACC,cAAD,EAAiBpB,WAAjB,EAA8B;IACnD,MAAMqB,aAAa,GAAGlC,iBAAiB,CAACmC,MAAlB,CACpB,CAACC,GAAD,EAAMC,KAAN,KAAiBJ,cAAc,CAACI,KAAD,CAAd,GAAwBD,GAAxB,GAA8B,CAAC,GAAGA,GAAJ,EAASC,KAAT,CAD3B,EAEpB,EAFoB,CAAtB;;IAKA,IAAI,CAACC,eAAA,CAAEC,OAAF,CAAUL,aAAV,CAAL,EAA+B;MAC7B,MAAM,IAAIM,KAAJ,CACH,WAAU3B,WAAY,kDAAvB,GACG,gCAA+BgB,IAAI,CAACC,SAAL,CAAeI,aAAf,CAA8B,EAF5D,CAAN;IAID;EACF;;AA1DyD"}