{"version":3,"file":"config.js","names":["npmPackage","fs","readPackageJsonFrom","__dirname","APPIUM_VER","version","MIN_NODE_VERSION","engines","node","MIN_NPM_VERSION","npm","GIT_META_ROOT","GIT_BINARY","system","isWindows","GITHUB_API","BUILD_INFO","getNodeVersion","semver","coerce","process","getNpmVersion","stdout","exec","trim","updateBuildInfo","useGithubApiFallback","sha","getGitRev","buildTimestamp","getGitTimestamp","built","findGitRoot","findUp","cwd","rootDir","type","gitRoot","ign","axios","get","headers","data","object","commitSha","tagger","date","getBuildInfo","checkNodeOk","satisfies","Error","checkNpmOk","npmVersion","warnNodeDeprecations","showBuildInfo","console","log","JSON","stringify","getNonDefaultServerArgs","parsedArgs","flatten","args","argSpecs","getAllArgSpecs","flattened","_","reduce","values","acc","argSpec","has","dest","value","typesDiffer","defaultsFromSchema","defaultValueIsArray","isArray","argsValueIsArray","arraysDiffer","gt","size","difference","valuesDiffer","defaultIsDefined","isUndefined","argValueNotArrayOrArraysDiffer","overSome","negate","defaultValueNotArrayAndValuesDiffer","overEvery","isNotDefault","getDefaultsForSchema","pickBy","__","key","set","compactConfig","partial","omitBy","isObject","isEmpty","showConfig","nonDefaultPreConfigParsedArgs","configResult","defaults","dir","config","filepath","validateTmpDir","tmpDir","mkdirp","e","findRoot"],"sources":["../../lib/config.js"],"sourcesContent":["/* eslint-disable no-console */\nimport _ from 'lodash';\nimport {system, fs} from '@appium/support';\nimport axios from 'axios';\nimport {exec} from 'teen_process';\nimport semver from 'semver';\nimport findUp from 'find-up';\nimport {getDefaultsForSchema, getAllArgSpecs} from './schema/schema';\n\nconst npmPackage = fs.readPackageJsonFrom(__dirname);\n\nconst APPIUM_VER = npmPackage.version;\nconst MIN_NODE_VERSION = npmPackage.engines.node;\nconst MIN_NPM_VERSION = npmPackage.engines.npm;\n\nconst GIT_META_ROOT = '.git';\nconst GIT_BINARY = `git${system.isWindows() ? '.exe' : ''}`;\nconst GITHUB_API = 'https://api.github.com/repos/appium/appium';\n\n/**\n * @type {import('appium/types').BuildInfo}\n */\nconst BUILD_INFO = {\n  version: APPIUM_VER,\n};\n\nfunction getNodeVersion() {\n  return /** @type {import('semver').SemVer} */ (semver.coerce(process.version));\n}\n\n/**\n * Returns version of `npm`\n * @returns {Promise<string>}\n */\nasync function getNpmVersion() {\n  const {stdout} = await exec(system.isWindows() ? 'npm.cmd' : 'npm', ['--version']);\n  return stdout.trim();\n}\n\n/**\n * @param {boolean} [useGithubApiFallback]\n */\nasync function updateBuildInfo(useGithubApiFallback = false) {\n  const sha = await getGitRev(useGithubApiFallback);\n  if (!sha) {\n    return;\n  }\n  BUILD_INFO['git-sha'] = sha;\n  const buildTimestamp = await getGitTimestamp(sha, useGithubApiFallback);\n  if (buildTimestamp) {\n    BUILD_INFO.built = buildTimestamp;\n  }\n}\n\n/**\n * Finds the Git metadata dir (see `GIT_META_ROOT`)\n *\n * This is needed because Appium cannot assume `package.json` and `.git` are in the same\n * directory.  Monorepos, see?\n * @returns {Promise<string|undefined>} Path to dir or `undefined` if not found\n */\nasync function findGitRoot() {\n  return await findUp(GIT_META_ROOT, {cwd: rootDir, type: 'directory'});\n}\n\n/**\n * @param {boolean} [useGithubApiFallback]\n * @returns {Promise<string?>}\n */\nasync function getGitRev(useGithubApiFallback = false) {\n  const gitRoot = await findGitRoot();\n  if (gitRoot) {\n    try {\n      const {stdout} = await exec(GIT_BINARY, ['rev-parse', 'HEAD'], {\n        cwd: gitRoot,\n      });\n      return stdout.trim();\n    } catch (ign) {}\n  }\n\n  if (!useGithubApiFallback) {\n    return null;\n  }\n\n  // If the package folder is not a valid git repository\n  // then fetch the corresponding tag info from GitHub\n  try {\n    return (\n      await axios.get(`${GITHUB_API}/git/refs/tags/appium@${APPIUM_VER}`, {\n        headers: {\n          'User-Agent': `Appium ${APPIUM_VER}`,\n        },\n      })\n    ).data?.object?.sha;\n  } catch (ign) {}\n  return null;\n}\n\n/**\n * @param {string} commitSha\n * @param {boolean} [useGithubApiFallback]\n * @returns {Promise<string?>}\n */\nasync function getGitTimestamp(commitSha, useGithubApiFallback = false) {\n  const gitRoot = await findGitRoot();\n  if (gitRoot) {\n    try {\n      const {stdout} = await exec(GIT_BINARY, ['show', '-s', '--format=%ci', commitSha], {\n        cwd: gitRoot,\n      });\n      return stdout.trim();\n    } catch (ign) {}\n  }\n\n  if (!useGithubApiFallback) {\n    return null;\n  }\n\n  try {\n    return (\n      await axios.get(`${GITHUB_API}/git/tags/${commitSha}`, {\n        headers: {\n          'User-Agent': `Appium ${APPIUM_VER}`,\n        },\n      })\n    ).data?.tagger?.date;\n  } catch (ign) {}\n  return null;\n}\n\n/**\n * Mutable object containing Appium build information. By default it\n * only contains the Appium version, but is updated with the build timestamp\n * and git commit hash asynchronously as soon as `updateBuildInfo` is called\n * and succeeds.\n * @returns {import('appium/types').BuildInfo}\n */\nfunction getBuildInfo() {\n  return BUILD_INFO;\n}\n\nfunction checkNodeOk() {\n  const version = getNodeVersion();\n  if (!semver.satisfies(version, MIN_NODE_VERSION)) {\n    throw new Error(\n      `Node version must be at least ${MIN_NODE_VERSION}; current is ${version.version}`\n    );\n  }\n}\n\nexport async function checkNpmOk() {\n  const npmVersion = await getNpmVersion();\n  if (!semver.satisfies(npmVersion, MIN_NPM_VERSION)) {\n    throw new Error(\n      `npm version must be at least ${MIN_NPM_VERSION}; current is ${npmVersion}. Run \"npm install -g npm\" to upgrade.`\n    );\n  }\n}\n\nfunction warnNodeDeprecations() {\n  /**\n   * Uncomment this section to get node version deprecation warnings\n   * Also add test cases to config-specs.js to cover the cases added\n   **/\n  // const version = getNodeVersion();\n  // if (version.major < 8) {\n  //   logger.warn(`Appium support for versions of node < ${version.major} has been ` +\n  //               'deprecated and will be removed in a future version. Please ' +\n  //               'upgrade!');\n  // }\n}\n\nasync function showBuildInfo() {\n  await updateBuildInfo(true);\n  console.log(JSON.stringify(getBuildInfo())); // eslint-disable-line no-console\n}\n\n/**\n * Returns k/v pairs of server arguments which are _not_ the defaults.\n * @param {Args} parsedArgs\n * @returns {Args}\n */\nfunction getNonDefaultServerArgs(parsedArgs) {\n  /**\n   * Flattens parsed args into a single level object for comparison with\n   * flattened defaults across server args and extension args.\n   * @param {Args} args\n   * @returns {Record<string, { value: any, argSpec: ArgSpec }>}\n   */\n  const flatten = (args) => {\n    const argSpecs = getAllArgSpecs();\n    const flattened = _.reduce(\n      [...argSpecs.values()],\n      (acc, argSpec) => {\n        if (_.has(args, argSpec.dest)) {\n          acc[argSpec.dest] = {value: _.get(args, argSpec.dest), argSpec};\n        }\n        return acc;\n      },\n      /** @type {Record<string, { value: any, argSpec: ArgSpec }>} */ ({})\n    );\n\n    return flattened;\n  };\n\n  const args = flatten(parsedArgs);\n\n  // hopefully these function names are descriptive enough\n  const typesDiffer = /** @param {string} dest */ (dest) =>\n    typeof args[dest].value !== typeof defaultsFromSchema[dest];\n\n  const defaultValueIsArray = /** @param {string} dest */ (dest) =>\n    _.isArray(defaultsFromSchema[dest]);\n\n  const argsValueIsArray = /** @param {string} dest */ (dest) => _.isArray(args[dest].value);\n\n  const arraysDiffer = /** @param {string} dest */ (dest) =>\n    _.gt(_.size(_.difference(args[dest].value, defaultsFromSchema[dest])), 0);\n\n  const valuesDiffer = /** @param {string} dest */ (dest) =>\n    args[dest].value !== defaultsFromSchema[dest];\n\n  const defaultIsDefined = /** @param {string} dest */ (dest) =>\n    !_.isUndefined(defaultsFromSchema[dest]);\n\n  // note that `_.overEvery` is like an \"AND\", and `_.overSome` is like an \"OR\"\n\n  const argValueNotArrayOrArraysDiffer = _.overSome([_.negate(argsValueIsArray), arraysDiffer]);\n\n  const defaultValueNotArrayAndValuesDiffer = _.overEvery([\n    _.negate(defaultValueIsArray),\n    valuesDiffer,\n  ]);\n\n  /**\n   * This used to be a hideous conditional, but it's broken up into a hideous function instead.\n   * hopefully this makes things a little more understandable.\n   * - checks if the default value is defined\n   * - if so, and the default is not an array:\n   *   - ensures the types are the same\n   *   - ensures the values are equal\n   * - if so, and the default is an array:\n   *   - ensures the args value is an array\n   *   - ensures the args values do not differ from the default values\n   * @type {(dest: string) => boolean}\n   */\n  const isNotDefault = _.overEvery([\n    defaultIsDefined,\n    _.overSome([\n      typesDiffer,\n      _.overEvery([defaultValueIsArray, argValueNotArrayOrArraysDiffer]),\n      defaultValueNotArrayAndValuesDiffer,\n    ]),\n  ]);\n\n  const defaultsFromSchema = getDefaultsForSchema(true);\n\n  return _.reduce(\n    _.pickBy(args, (__, key) => isNotDefault(key)),\n    // explodes the flattened object back into nested one\n    (acc, {value, argSpec}) => _.set(acc, argSpec.dest, value),\n    /** @type {Args} */ ({})\n  );\n}\n\n/**\n * Compacts an object for {@link showConfig}:\n * 1. Removes `subcommand` key/value\n * 2. Removes `undefined` values\n * 3. Removes empty objects (but not `false` values)\n * Does not operate recursively.\n */\nconst compactConfig = _.partial(\n  _.omitBy,\n  _,\n  (value, key) =>\n    key === 'subcommand' || _.isUndefined(value) || (_.isObject(value) && _.isEmpty(value))\n);\n\n/**\n * Shows a breakdown of the current config after CLI params, config file loaded & defaults applied.\n *\n * The actual shape of `preConfigParsedArgs` and `defaults` does not matter for the purposes of this function,\n * but it's intended to be called with values of type {@link ParsedArgs} and `DefaultValues<true>`, respectively.\n *\n * @param {Partial<ParsedArgs>} nonDefaultPreConfigParsedArgs - Parsed CLI args (or param to `init()`) before config & defaults applied\n * @param {import('./config-file').ReadConfigFileResult} configResult - Result of attempting to load a config file.  _Must_ be normalized\n * @param {Partial<ParsedArgs>} defaults - Configuration defaults from schemas\n * @param {ParsedArgs} parsedArgs - Entire parsed args object\n */\nfunction showConfig(nonDefaultPreConfigParsedArgs, configResult, defaults, parsedArgs) {\n  console.log('Appium Configuration\\n');\n  console.log('from defaults:\\n');\n  console.dir(compactConfig(defaults));\n  if (configResult.config) {\n    console.log(`\\nfrom config file at ${configResult.filepath}:\\n`);\n    console.dir(compactConfig(configResult.config));\n  } else {\n    console.log(`\\n(no configuration file loaded)`);\n  }\n  if (_.isEmpty(nonDefaultPreConfigParsedArgs)) {\n    console.log(`\\n(no CLI parameters provided)`);\n  } else {\n    console.log('\\nvia CLI or function call:\\n');\n    console.dir(compactConfig(nonDefaultPreConfigParsedArgs));\n  }\n  console.log('\\nfinal configuration:\\n');\n  console.dir(compactConfig(parsedArgs));\n}\n\n/**\n * @param {string} tmpDir\n */\nasync function validateTmpDir(tmpDir) {\n  try {\n    await fs.mkdirp(tmpDir);\n  } catch (e) {\n    throw new Error(\n      `We could not ensure that the temp dir you specified ` +\n        `(${tmpDir}) exists. Please make sure it's writeable.`\n    );\n  }\n}\n\nconst rootDir = fs.findRoot(__dirname);\n\nexport {\n  getBuildInfo,\n  checkNodeOk,\n  showBuildInfo,\n  warnNodeDeprecations,\n  validateTmpDir,\n  getNonDefaultServerArgs,\n  getGitRev,\n  APPIUM_VER,\n  updateBuildInfo,\n  showConfig,\n  rootDir,\n};\n\n/**\n * @typedef {import('appium/types').ParsedArgs} ParsedArgs\n * @typedef {import('appium/types').Args} Args\n * @typedef {import('./schema/arg-spec').ArgSpec} ArgSpec\n */\n"],"mappings":"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"}