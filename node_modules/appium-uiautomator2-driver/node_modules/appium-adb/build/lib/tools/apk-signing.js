"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _lodash = _interopRequireDefault(require("lodash"));
var _fs2 = _interopRequireDefault(require("fs"));
var _teen_process = require("teen_process");
var _path = _interopRequireDefault(require("path"));
var _logger = _interopRequireDefault(require("../logger.js"));
var _support = require("@appium/support");
var _lruCache = _interopRequireDefault(require("lru-cache"));
var _helpers = require("../helpers.js");
const DEFAULT_PRIVATE_KEY = _path.default.resolve((0, _helpers.getModuleRoot)(), 'keys', 'testkey.pk8');
const DEFAULT_CERTIFICATE = _path.default.resolve((0, _helpers.getModuleRoot)(), 'keys', 'testkey.x509.pem');
const BUNDLETOOL_TUTORIAL = 'https://developer.android.com/studio/command-line/bundletool';
const APKSIGNER_VERIFY_FAIL = 'DOES NOT VERIFY';
const SHA1 = 'sha1';
const SHA256 = 'sha256';
const SHA512 = 'sha512';
const MD5 = 'md5';
const DEFAULT_CERT_HASH = {
  [SHA256]: 'a40da80a59d170caa950cf15c18c454d47a39b26989d8b640ecd745ba71bf5dc'
};
const JAVA_PROPS_INIT_ERROR = 'java.lang.Error: Properties init';
const SIGNED_APPS_CACHE = new _lruCache.default({
  max: 30
});
const apkSigningMethods = {};

apkSigningMethods.executeApksigner = async function executeApksigner(args = []) {
  const apkSignerJar = await (0, _helpers.getApksignerForOs)(this);
  const fullCmd = [await (0, _helpers.getJavaForOs)(), '-Xmx1024M', '-Xss1m', '-jar', apkSignerJar, ...args];
  _logger.default.debug(`Starting apksigner: ${_support.util.quote(fullCmd)}`);
  const {
    stdout,
    stderr
  } = await (0, _teen_process.exec)(fullCmd[0], fullCmd.slice(1), {
    cwd: _path.default.dirname(apkSignerJar),
    windowsVerbatimArguments: _support.system.isWindows()
  });
  for (let [name, stream] of [['stdout', stdout], ['stderr', stderr]]) {
    if (!_lodash.default.trim(stream)) {
      continue;
    }
    if (name === 'stdout') {
      stream = stream.split('\n').filter(line => !line.includes('WARNING:')).join('\n');
    }
    _logger.default.debug(`apksigner ${name}: ${stream}`);
  }
  return stdout;
};

apkSigningMethods.signWithDefaultCert = async function signWithDefaultCert(apk) {
  _logger.default.debug(`Signing '${apk}' with default cert`);
  if (!(await _support.fs.exists(apk))) {
    throw new Error(`${apk} file doesn't exist.`);
  }
  const args = ['sign', '--key', DEFAULT_PRIVATE_KEY, '--cert', DEFAULT_CERTIFICATE, apk];
  try {
    await this.executeApksigner(args);
  } catch (e) {
    throw new Error(`Could not sign '${apk}' with the default certificate. ` + `Original error: ${e.stderr || e.stdout || e.message}`);
  }
};

apkSigningMethods.signWithCustomCert = async function signWithCustomCert(apk) {
  _logger.default.debug(`Signing '${apk}' with custom cert`);
  if (!(await _support.fs.exists(this.keystorePath))) {
    throw new Error(`Keystore: ${this.keystorePath} doesn't exist.`);
  }
  if (!(await _support.fs.exists(apk))) {
    throw new Error(`'${apk}' doesn't exist.`);
  }
  try {
    await this.executeApksigner(['sign', '--ks', this.keystorePath, '--ks-key-alias', this.keyAlias, '--ks-pass', `pass:${this.keystorePassword}`, '--key-pass', `pass:${this.keyPassword}`, apk]);
  } catch (err) {
    _logger.default.warn(`Cannot use apksigner tool for signing. Defaulting to jarsigner. ` + `Original error: ${err.stderr || err.stdout || err.message}`);
    try {
      if (await (0, _helpers.unsignApk)(apk)) {
        _logger.default.debug(`'${apk}' has been successfully unsigned`);
      } else {
        _logger.default.debug(`'${apk}' does not need to be unsigned`);
      }
      const jarsigner = _path.default.resolve(await (0, _helpers.getJavaHome)(), 'bin', `jarsigner${_support.system.isWindows() ? '.exe' : ''}`);
      const fullCmd = [jarsigner, '-sigalg', 'MD5withRSA', '-digestalg', 'SHA1', '-keystore', this.keystorePath, '-storepass', this.keystorePassword, '-keypass', this.keyPassword, apk, this.keyAlias];
      _logger.default.debug(`Starting jarsigner: ${_support.util.quote(fullCmd)}`);
      await (0, _teen_process.exec)(fullCmd[0], fullCmd.slice(1), {
        windowsVerbatimArguments: _support.system.isWindows()
      });
    } catch (e) {
      throw new Error(`Could not sign with custom certificate. ` + `Original error: ${e.stderr || e.message}`);
    }
  }
};

apkSigningMethods.sign = async function sign(appPath) {
  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    let message = 'Signing of .apks-files is not supported. ';
    if (this.useKeystore) {
      message += 'Consider manual application bundle signing with the custom keystore ' + `like it is described at ${BUNDLETOOL_TUTORIAL}`;
    } else {
      message += `Consider manual application bundle signing with the key at '${DEFAULT_PRIVATE_KEY}' ` + `and the certificate at '${DEFAULT_CERTIFICATE}'. Read ${BUNDLETOOL_TUTORIAL} for more details.`;
    }
    _logger.default.warn(message);
    return;
  }

  await this.zipAlignApk(appPath);
  if (this.useKeystore) {
    await this.signWithCustomCert(appPath);
  } else {
    await this.signWithDefaultCert(appPath);
  }
};

apkSigningMethods.zipAlignApk = async function zipAlignApk(apk) {
  await this.initZipAlign();
  try {
    await (0, _teen_process.exec)(this.binaries.zipalign, ['-c', '4', apk]);
    _logger.default.debug(`${apk}' is already zip-aligned. Doing nothing`);
    return false;
  } catch (e) {
    _logger.default.debug(`'${apk}' is not zip-aligned. Aligning`);
  }
  try {
    await _support.fs.access(apk, _fs2.default.W_OK);
  } catch (e) {
    throw new Error(`The file at '${apk}' is not writeable. ` + `Please grant write permissions to this file or to its parent folder '${_path.default.dirname(apk)}' ` + `for the Appium process, so it can zip-align the file`);
  }
  const alignedApk = await _support.tempDir.path({
    prefix: 'appium',
    suffix: '.tmp'
  });
  await (0, _support.mkdirp)(_path.default.dirname(alignedApk));
  try {
    await (0, _teen_process.exec)(this.binaries.zipalign, ['-f', '4', apk, alignedApk]);
    await _support.fs.mv(alignedApk, apk, {
      mkdirp: true
    });
    return true;
  } catch (e) {
    if (await _support.fs.exists(alignedApk)) {
      await _support.fs.unlink(alignedApk);
    }
    throw new Error(`zipAlignApk failed. Original error: ${e.stderr || e.message}`);
  }
};

apkSigningMethods.checkApkCert = async function checkApkCert(appPath, pkg, opts = {}) {
  _logger.default.debug(`Checking app cert for ${appPath}`);
  if (!(await _support.fs.exists(appPath))) {
    _logger.default.debug(`'${appPath}' does not exist`);
    return false;
  }
  if (_path.default.extname(appPath) === _helpers.APKS_EXTENSION) {
    appPath = await this.extractBaseApk(appPath);
  }
  const hashMatches = (apksignerOutput, expectedHashes) => {
    for (const [name, value] of _lodash.default.toPairs(expectedHashes)) {
      if (new RegExp(`digest:\\s+${value}\\b`, 'i').test(apksignerOutput)) {
        _logger.default.debug(`${name} hash did match for '${_path.default.basename(appPath)}'`);
        return true;
      }
    }
    return false;
  };
  const {
    requireDefaultCert = true
  } = opts;
  const appHash = await _support.fs.hash(appPath);
  if (SIGNED_APPS_CACHE.has(appHash)) {
    _logger.default.debug(`Using the previously cached signature entry for '${_path.default.basename(appPath)}'`);
    const {
      keystorePath,
      output,
      expected
    } = SIGNED_APPS_CACHE.get(appHash);
    if (this.useKeystore && this.keystorePath === keystorePath || !this.useKeystore) {
      return !this.useKeystore && !requireDefaultCert || hashMatches(output, expected);
    }
  }
  const expected = this.useKeystore ? await this.getKeystoreHash(appPath, pkg) : DEFAULT_CERT_HASH;
  try {
    await (0, _helpers.getApksignerForOs)(this);
    const output = await this.executeApksigner(['verify', '--print-certs', appPath]);
    const hasMatch = hashMatches(output, expected);
    if (hasMatch) {
      _logger.default.info(`'${appPath}' is signed with the ` + `${this.useKeystore ? 'keystore' : 'default'} certificate`);
    } else {
      _logger.default.info(`'${appPath}' is signed with a ` + `non-${this.useKeystore ? 'keystore' : 'default'} certificate`);
    }
    const isSigned = !this.useKeystore && !requireDefaultCert || hasMatch;
    if (isSigned) {
      SIGNED_APPS_CACHE.set(appHash, {
        output,
        expected,
        keystorePath: this.keystorePath
      });
    }
    return isSigned;
  } catch (err) {
    if (_lodash.default.includes(err.stderr, APKSIGNER_VERIFY_FAIL)) {
      _logger.default.info(`'${appPath}' is not signed`);
      return false;
    }
    const errMsg = err.stderr || err.stdout || err.message;
    if (_lodash.default.includes(errMsg, JAVA_PROPS_INIT_ERROR)) {
      _logger.default.warn(errMsg);
      _logger.default.warn(`Assuming '${appPath}' is already signed and continuing anyway`);
      return true;
    }
    throw new Error(`Cannot verify the signature of '${appPath}'. ` + `Original error: ${errMsg}`);
  }
};

apkSigningMethods.getKeystoreHash = async function getKeystoreHash() {
  _logger.default.debug(`Getting hash of the '${this.keystorePath}' keystore`);
  const keytool = _path.default.resolve(await (0, _helpers.getJavaHome)(), 'bin', `keytool${_support.system.isWindows() ? '.exe' : ''}`);
  if (!(await _support.fs.exists(keytool))) {
    throw new Error(`The keytool utility cannot be found at '${keytool}'`);
  }
  const args = ['-v', '-list', '-alias', this.keyAlias, '-keystore', this.keystorePath, '-storepass', this.keystorePassword];
  _logger.default.info(`Running '${keytool}' with arguments: ${_support.util.quote(args)}`);
  try {
    const {
      stdout
    } = await (0, _teen_process.exec)(keytool, args, {
      windowsVerbatimArguments: _support.system.isWindows()
    });
    const result = {};
    for (const hashName of [SHA512, SHA256, SHA1, MD5]) {
      const hashRe = new RegExp(`^\\s*${hashName}:\\s*([a-f0-9:]+)`, 'mi');
      const match = hashRe.exec(stdout);
      if (!match) {
        continue;
      }
      result[hashName] = match[1].replace(/:/g, '').toLowerCase();
    }
    if (_lodash.default.isEmpty(result)) {
      _logger.default.debug(stdout);
      throw new Error('Cannot parse the hash value from the keytool output');
    }
    _logger.default.debug(`Keystore hash: ${JSON.stringify(result)}`);
    return result;
  } catch (e) {
    throw new Error(`Cannot get the hash of '${this.keystorePath}' keystore. ` + `Original error: ${e.stderr || e.message}`);
  }
};
var _default = apkSigningMethods;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJERUZBVUxUX1BSSVZBVEVfS0VZIiwicGF0aCIsInJlc29sdmUiLCJnZXRNb2R1bGVSb290IiwiREVGQVVMVF9DRVJUSUZJQ0FURSIsIkJVTkRMRVRPT0xfVFVUT1JJQUwiLCJBUEtTSUdORVJfVkVSSUZZX0ZBSUwiLCJTSEExIiwiU0hBMjU2IiwiU0hBNTEyIiwiTUQ1IiwiREVGQVVMVF9DRVJUX0hBU0giLCJKQVZBX1BST1BTX0lOSVRfRVJST1IiLCJTSUdORURfQVBQU19DQUNIRSIsIkxSVSIsIm1heCIsImFwa1NpZ25pbmdNZXRob2RzIiwiZXhlY3V0ZUFwa3NpZ25lciIsImFyZ3MiLCJhcGtTaWduZXJKYXIiLCJnZXRBcGtzaWduZXJGb3JPcyIsImZ1bGxDbWQiLCJnZXRKYXZhRm9yT3MiLCJsb2ciLCJkZWJ1ZyIsInV0aWwiLCJxdW90ZSIsInN0ZG91dCIsInN0ZGVyciIsImV4ZWMiLCJzbGljZSIsImN3ZCIsImRpcm5hbWUiLCJ3aW5kb3dzVmVyYmF0aW1Bcmd1bWVudHMiLCJzeXN0ZW0iLCJpc1dpbmRvd3MiLCJuYW1lIiwic3RyZWFtIiwiXyIsInRyaW0iLCJzcGxpdCIsImZpbHRlciIsImxpbmUiLCJpbmNsdWRlcyIsImpvaW4iLCJzaWduV2l0aERlZmF1bHRDZXJ0IiwiYXBrIiwiZnMiLCJleGlzdHMiLCJFcnJvciIsImUiLCJtZXNzYWdlIiwic2lnbldpdGhDdXN0b21DZXJ0Iiwia2V5c3RvcmVQYXRoIiwia2V5QWxpYXMiLCJrZXlzdG9yZVBhc3N3b3JkIiwia2V5UGFzc3dvcmQiLCJlcnIiLCJ3YXJuIiwidW5zaWduQXBrIiwiamFyc2lnbmVyIiwiZ2V0SmF2YUhvbWUiLCJzaWduIiwiYXBwUGF0aCIsImVuZHNXaXRoIiwiQVBLU19FWFRFTlNJT04iLCJ1c2VLZXlzdG9yZSIsInppcEFsaWduQXBrIiwiaW5pdFppcEFsaWduIiwiYmluYXJpZXMiLCJ6aXBhbGlnbiIsImFjY2VzcyIsIl9mcyIsIldfT0siLCJhbGlnbmVkQXBrIiwidGVtcERpciIsInByZWZpeCIsInN1ZmZpeCIsIm1rZGlycCIsIm12IiwidW5saW5rIiwiY2hlY2tBcGtDZXJ0IiwicGtnIiwib3B0cyIsImV4dG5hbWUiLCJleHRyYWN0QmFzZUFwayIsImhhc2hNYXRjaGVzIiwiYXBrc2lnbmVyT3V0cHV0IiwiZXhwZWN0ZWRIYXNoZXMiLCJ2YWx1ZSIsInRvUGFpcnMiLCJSZWdFeHAiLCJ0ZXN0IiwiYmFzZW5hbWUiLCJyZXF1aXJlRGVmYXVsdENlcnQiLCJhcHBIYXNoIiwiaGFzaCIsImhhcyIsIm91dHB1dCIsImV4cGVjdGVkIiwiZ2V0IiwiZ2V0S2V5c3RvcmVIYXNoIiwiaGFzTWF0Y2giLCJpbmZvIiwiaXNTaWduZWQiLCJzZXQiLCJlcnJNc2ciLCJrZXl0b29sIiwicmVzdWx0IiwiaGFzaE5hbWUiLCJoYXNoUmUiLCJtYXRjaCIsInJlcGxhY2UiLCJ0b0xvd2VyQ2FzZSIsImlzRW1wdHkiLCJKU09OIiwic3RyaW5naWZ5Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL3Rvb2xzL2Fway1zaWduaW5nLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgX2ZzIGZyb20gJ2ZzJztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlci5qcyc7XG5pbXBvcnQgeyB0ZW1wRGlyLCBzeXN0ZW0sIG1rZGlycCwgZnMsIHV0aWwgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IExSVSBmcm9tICdscnUtY2FjaGUnO1xuaW1wb3J0IHtcbiAgZ2V0SmF2YUZvck9zLCBnZXRBcGtzaWduZXJGb3JPcywgZ2V0SmF2YUhvbWUsIGdldE1vZHVsZVJvb3QsIEFQS1NfRVhURU5TSU9OLCB1bnNpZ25BcGssXG59IGZyb20gJy4uL2hlbHBlcnMuanMnO1xuXG5jb25zdCBERUZBVUxUX1BSSVZBVEVfS0VZID0gcGF0aC5yZXNvbHZlKGdldE1vZHVsZVJvb3QoKSwgJ2tleXMnLCAndGVzdGtleS5wazgnKTtcbmNvbnN0IERFRkFVTFRfQ0VSVElGSUNBVEUgPSBwYXRoLnJlc29sdmUoZ2V0TW9kdWxlUm9vdCgpLCAna2V5cycsICd0ZXN0a2V5Lng1MDkucGVtJyk7XG5jb25zdCBCVU5ETEVUT09MX1RVVE9SSUFMID0gJ2h0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3N0dWRpby9jb21tYW5kLWxpbmUvYnVuZGxldG9vbCc7XG5jb25zdCBBUEtTSUdORVJfVkVSSUZZX0ZBSUwgPSAnRE9FUyBOT1QgVkVSSUZZJztcbmNvbnN0IFNIQTEgPSAnc2hhMSc7XG5jb25zdCBTSEEyNTYgPSAnc2hhMjU2JztcbmNvbnN0IFNIQTUxMiA9ICdzaGE1MTInO1xuY29uc3QgTUQ1ID0gJ21kNSc7XG5jb25zdCBERUZBVUxUX0NFUlRfSEFTSCA9IHtcbiAgW1NIQTI1Nl06ICdhNDBkYTgwYTU5ZDE3MGNhYTk1MGNmMTVjMThjNDU0ZDQ3YTM5YjI2OTg5ZDhiNjQwZWNkNzQ1YmE3MWJmNWRjJ1xufTtcbmNvbnN0IEpBVkFfUFJPUFNfSU5JVF9FUlJPUiA9ICdqYXZhLmxhbmcuRXJyb3I6IFByb3BlcnRpZXMgaW5pdCc7XG5jb25zdCBTSUdORURfQVBQU19DQUNIRSA9IG5ldyBMUlUoe1xuICBtYXg6IDMwLFxufSk7XG5cblxuY29uc3QgYXBrU2lnbmluZ01ldGhvZHMgPSB7fTtcblxuLyoqXG4gKiBFeGVjdXRlIGFwa3NpZ25lciB1dGlsaXR5IHdpdGggZ2l2ZW4gYXJndW1lbnRzLlxuICpcbiAqIEBwYXJhbSB7P0FycmF5PFN0cmluZz59IGFyZ3MgLSBUaGUgbGlzdCBvZiB0b29sIGFyZ3VtZW50cy5cbiAqIEByZXR1cm4ge3N0cmluZ30gLSBDb21tYW5kIHN0ZG91dFxuICogQHRocm93cyB7RXJyb3J9IElmIGFwa3NpZ25lciBiaW5hcnkgaXMgbm90IHByZXNlbnQgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtXG4gKiAgICAgICAgICAgICAgICAgb3IgdGhlIHJldHVybiBjb2RlIGlzIG5vdCBlcXVhbCB0byB6ZXJvLlxuICovXG5hcGtTaWduaW5nTWV0aG9kcy5leGVjdXRlQXBrc2lnbmVyID0gYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUFwa3NpZ25lciAoYXJncyA9IFtdKSB7XG4gIGNvbnN0IGFwa1NpZ25lckphciA9IGF3YWl0IGdldEFwa3NpZ25lckZvck9zKHRoaXMpO1xuICBjb25zdCBmdWxsQ21kID0gW1xuICAgIGF3YWl0IGdldEphdmFGb3JPcygpLCAnLVhteDEwMjRNJywgJy1Yc3MxbScsXG4gICAgJy1qYXInLCBhcGtTaWduZXJKYXIsXG4gICAgLi4uYXJnc1xuICBdO1xuICBsb2cuZGVidWcoYFN0YXJ0aW5nIGFwa3NpZ25lcjogJHt1dGlsLnF1b3RlKGZ1bGxDbWQpfWApO1xuICAvLyBJdCBpcyBuZWNlc3NhcnkgdG8gc3BlY2lmeSBDV0QgZXhwbGljaXRseTsgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2lzc3Vlcy8xNDcyNCNpc3N1ZWNvbW1lbnQtNzM3NDQ2NzE1XG4gIGNvbnN0IHtzdGRvdXQsIHN0ZGVycn0gPSBhd2FpdCBleGVjKGZ1bGxDbWRbMF0sIGZ1bGxDbWQuc2xpY2UoMSksIHtcbiAgICBjd2Q6IHBhdGguZGlybmFtZShhcGtTaWduZXJKYXIpLCB3aW5kb3dzVmVyYmF0aW1Bcmd1bWVudHM6IHN5c3RlbS5pc1dpbmRvd3MoKVxuICB9KTtcbiAgZm9yIChsZXQgW25hbWUsIHN0cmVhbV0gb2YgW1snc3Rkb3V0Jywgc3Rkb3V0XSwgWydzdGRlcnInLCBzdGRlcnJdXSkge1xuICAgIGlmICghXy50cmltKHN0cmVhbSkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmIChuYW1lID09PSAnc3Rkb3V0Jykge1xuICAgICAgLy8gTWFrZSB0aGUgb3V0cHV0IGxlc3MgdGFsa2F0aXZlXG4gICAgICBzdHJlYW0gPSBzdHJlYW0uc3BsaXQoJ1xcbicpXG4gICAgICAgIC5maWx0ZXIoKGxpbmUpID0+ICFsaW5lLmluY2x1ZGVzKCdXQVJOSU5HOicpKVxuICAgICAgICAuam9pbignXFxuJyk7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgYXBrc2lnbmVyICR7bmFtZX06ICR7c3RyZWFtfWApO1xuICB9XG4gIHJldHVybiBzdGRvdXQ7XG59O1xuXG4vKipcbiAqIChSZSlzaWduIHRoZSBnaXZlbiBhcGsgZmlsZSBvbiB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0gd2l0aCB0aGUgZGVmYXVsdCBjZXJ0aWZpY2F0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgbG9jYWwgYXBrIGZpbGUuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgc2lnbmluZyBmYWlscy5cbiAqL1xuYXBrU2lnbmluZ01ldGhvZHMuc2lnbldpdGhEZWZhdWx0Q2VydCA9IGFzeW5jIGZ1bmN0aW9uIHNpZ25XaXRoRGVmYXVsdENlcnQgKGFwaykge1xuICBsb2cuZGVidWcoYFNpZ25pbmcgJyR7YXBrfScgd2l0aCBkZWZhdWx0IGNlcnRgKTtcbiAgaWYgKCEoYXdhaXQgZnMuZXhpc3RzKGFwaykpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke2Fwa30gZmlsZSBkb2Vzbid0IGV4aXN0LmApO1xuICB9XG5cbiAgY29uc3QgYXJncyA9IFtcbiAgICAnc2lnbicsXG4gICAgJy0ta2V5JywgREVGQVVMVF9QUklWQVRFX0tFWSxcbiAgICAnLS1jZXJ0JywgREVGQVVMVF9DRVJUSUZJQ0FURSxcbiAgICBhcGssXG4gIF07XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlQXBrc2lnbmVyKGFyZ3MpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3Qgc2lnbiAnJHthcGt9JyB3aXRoIHRoZSBkZWZhdWx0IGNlcnRpZmljYXRlLiBgICtcbiAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLnN0ZGVyciB8fCBlLnN0ZG91dCB8fCBlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogKFJlKXNpZ24gdGhlIGdpdmVuIGFwayBmaWxlIG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbSB3aXRoIGEgY3VzdG9tIGNlcnRpZmljYXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcGsgLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBsb2NhbCBhcGsgZmlsZS5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBzaWduaW5nIGZhaWxzLlxuICovXG5hcGtTaWduaW5nTWV0aG9kcy5zaWduV2l0aEN1c3RvbUNlcnQgPSBhc3luYyBmdW5jdGlvbiBzaWduV2l0aEN1c3RvbUNlcnQgKGFwaykge1xuICBsb2cuZGVidWcoYFNpZ25pbmcgJyR7YXBrfScgd2l0aCBjdXN0b20gY2VydGApO1xuICBpZiAoIShhd2FpdCBmcy5leGlzdHModGhpcy5rZXlzdG9yZVBhdGgpKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgS2V5c3RvcmU6ICR7dGhpcy5rZXlzdG9yZVBhdGh9IGRvZXNuJ3QgZXhpc3QuYCk7XG4gIH1cbiAgaWYgKCEoYXdhaXQgZnMuZXhpc3RzKGFwaykpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAnJHthcGt9JyBkb2Vzbid0IGV4aXN0LmApO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBcGtzaWduZXIoWydzaWduJyxcbiAgICAgICctLWtzJywgdGhpcy5rZXlzdG9yZVBhdGgsXG4gICAgICAnLS1rcy1rZXktYWxpYXMnLCB0aGlzLmtleUFsaWFzLFxuICAgICAgJy0ta3MtcGFzcycsIGBwYXNzOiR7dGhpcy5rZXlzdG9yZVBhc3N3b3JkfWAsXG4gICAgICAnLS1rZXktcGFzcycsIGBwYXNzOiR7dGhpcy5rZXlQYXNzd29yZH1gLFxuICAgICAgYXBrXSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy53YXJuKGBDYW5ub3QgdXNlIGFwa3NpZ25lciB0b29sIGZvciBzaWduaW5nLiBEZWZhdWx0aW5nIHRvIGphcnNpZ25lci4gYCArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZXJyLnN0ZGVyciB8fCBlcnIuc3Rkb3V0IHx8IGVyci5tZXNzYWdlfWApO1xuICAgIHRyeSB7XG4gICAgICBpZiAoYXdhaXQgdW5zaWduQXBrKGFwaykpIHtcbiAgICAgICAgbG9nLmRlYnVnKGAnJHthcGt9JyBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgdW5zaWduZWRgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgJyR7YXBrfScgZG9lcyBub3QgbmVlZCB0byBiZSB1bnNpZ25lZGApO1xuICAgICAgfVxuICAgICAgY29uc3QgamFyc2lnbmVyID0gcGF0aC5yZXNvbHZlKGF3YWl0IGdldEphdmFIb21lKCksICdiaW4nLFxuICAgICAgICBgamFyc2lnbmVyJHtzeXN0ZW0uaXNXaW5kb3dzKCkgPyAnLmV4ZScgOiAnJ31gKTtcbiAgICAgIGNvbnN0IGZ1bGxDbWQgPSBbamFyc2lnbmVyLFxuICAgICAgICAnLXNpZ2FsZycsICdNRDV3aXRoUlNBJyxcbiAgICAgICAgJy1kaWdlc3RhbGcnLCAnU0hBMScsXG4gICAgICAgICcta2V5c3RvcmUnLCB0aGlzLmtleXN0b3JlUGF0aCxcbiAgICAgICAgJy1zdG9yZXBhc3MnLCB0aGlzLmtleXN0b3JlUGFzc3dvcmQsXG4gICAgICAgICcta2V5cGFzcycsIHRoaXMua2V5UGFzc3dvcmQsXG4gICAgICAgIGFwaywgdGhpcy5rZXlBbGlhc107XG4gICAgICBsb2cuZGVidWcoYFN0YXJ0aW5nIGphcnNpZ25lcjogJHt1dGlsLnF1b3RlKGZ1bGxDbWQpfWApO1xuICAgICAgYXdhaXQgZXhlYyhmdWxsQ21kWzBdLCBmdWxsQ21kLnNsaWNlKDEpLCB7IHdpbmRvd3NWZXJiYXRpbUFyZ3VtZW50czogc3lzdGVtLmlzV2luZG93cygpIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IHNpZ24gd2l0aCBjdXN0b20gY2VydGlmaWNhdGUuIGAgK1xuICAgICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5zdGRlcnIgfHwgZS5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxufTtcblxuLyoqXG4gKiAoUmUpc2lnbiB0aGUgZ2l2ZW4gYXBrIGZpbGUgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtIHdpdGggZWl0aGVyXG4gKiBjdXN0b20gb3IgZGVmYXVsdCBjZXJ0aWZpY2F0ZSBiYXNlZCBvbiBfdGhpcy51c2VLZXlzdG9yZV8gcHJvcGVydHkgdmFsdWVcbiAqIGFuZCBaaXAtYWxpZ25zIGl0IGFmdGVyIHNpZ25pbmcuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBsb2NhbCAuYXBrKHMpIGZpbGUuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgc2lnbmluZyBmYWlscy5cbiAqL1xuYXBrU2lnbmluZ01ldGhvZHMuc2lnbiA9IGFzeW5jIGZ1bmN0aW9uIHNpZ24gKGFwcFBhdGgpIHtcbiAgaWYgKGFwcFBhdGguZW5kc1dpdGgoQVBLU19FWFRFTlNJT04pKSB7XG4gICAgbGV0IG1lc3NhZ2UgPSAnU2lnbmluZyBvZiAuYXBrcy1maWxlcyBpcyBub3Qgc3VwcG9ydGVkLiAnO1xuICAgIGlmICh0aGlzLnVzZUtleXN0b3JlKSB7XG4gICAgICBtZXNzYWdlICs9ICdDb25zaWRlciBtYW51YWwgYXBwbGljYXRpb24gYnVuZGxlIHNpZ25pbmcgd2l0aCB0aGUgY3VzdG9tIGtleXN0b3JlICcgK1xuICAgICAgICBgbGlrZSBpdCBpcyBkZXNjcmliZWQgYXQgJHtCVU5ETEVUT09MX1RVVE9SSUFMfWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1lc3NhZ2UgKz0gYENvbnNpZGVyIG1hbnVhbCBhcHBsaWNhdGlvbiBidW5kbGUgc2lnbmluZyB3aXRoIHRoZSBrZXkgYXQgJyR7REVGQVVMVF9QUklWQVRFX0tFWX0nIGAgK1xuICAgICAgICBgYW5kIHRoZSBjZXJ0aWZpY2F0ZSBhdCAnJHtERUZBVUxUX0NFUlRJRklDQVRFfScuIFJlYWQgJHtCVU5ETEVUT09MX1RVVE9SSUFMfSBmb3IgbW9yZSBkZXRhaWxzLmA7XG4gICAgfVxuICAgIGxvZy53YXJuKG1lc3NhZ2UpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGl0IGlzIG5lY2Vzc2FyeSB0byBhcHBseSB6aXBhbGlnbiBvbmx5IGJlZm9yZSBzaWduaW5nXG4gIC8vIGlmIGFwa3NpZ25lciBpcyB1c2VkXG4gIGF3YWl0IHRoaXMuemlwQWxpZ25BcGsoYXBwUGF0aCk7XG5cbiAgaWYgKHRoaXMudXNlS2V5c3RvcmUpIHtcbiAgICBhd2FpdCB0aGlzLnNpZ25XaXRoQ3VzdG9tQ2VydChhcHBQYXRoKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCB0aGlzLnNpZ25XaXRoRGVmYXVsdENlcnQoYXBwUGF0aCk7XG4gIH1cbn07XG5cbi8qKlxuICogUGVyZm9ybSB6aXAtYWxpZ25pbmcgdG8gdGhlIGdpdmVuIGxvY2FsIGFwayBmaWxlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcGsgLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBsb2NhbCBhcGsgZmlsZS5cbiAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHRoZSBhcGsgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGFsaWduZWRcbiAqIG9yIGZhbHNlIGlmIHRoZSBhcGsgaGFzIGJlZW4gYWxyZWFkeSBhbGlnbmVkLlxuICogQHRocm93cyB7RXJyb3J9IElmIHppcC1hbGlnbiBmYWlscy5cbiAqL1xuYXBrU2lnbmluZ01ldGhvZHMuemlwQWxpZ25BcGsgPSBhc3luYyBmdW5jdGlvbiB6aXBBbGlnbkFwayAoYXBrKSB7XG4gIGF3YWl0IHRoaXMuaW5pdFppcEFsaWduKCk7XG4gIHRyeSB7XG4gICAgYXdhaXQgZXhlYyh0aGlzLmJpbmFyaWVzLnppcGFsaWduLCBbJy1jJywgJzQnLCBhcGtdKTtcbiAgICBsb2cuZGVidWcoYCR7YXBrfScgaXMgYWxyZWFkeSB6aXAtYWxpZ25lZC4gRG9pbmcgbm90aGluZ2ApO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy5kZWJ1ZyhgJyR7YXBrfScgaXMgbm90IHppcC1hbGlnbmVkLiBBbGlnbmluZ2ApO1xuICB9XG4gIHRyeSB7XG4gICAgYXdhaXQgZnMuYWNjZXNzKGFwaywgX2ZzLldfT0spO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgZmlsZSBhdCAnJHthcGt9JyBpcyBub3Qgd3JpdGVhYmxlLiBgICtcbiAgICAgIGBQbGVhc2UgZ3JhbnQgd3JpdGUgcGVybWlzc2lvbnMgdG8gdGhpcyBmaWxlIG9yIHRvIGl0cyBwYXJlbnQgZm9sZGVyICcke3BhdGguZGlybmFtZShhcGspfScgYCArXG4gICAgICBgZm9yIHRoZSBBcHBpdW0gcHJvY2Vzcywgc28gaXQgY2FuIHppcC1hbGlnbiB0aGUgZmlsZWApO1xuICB9XG4gIGNvbnN0IGFsaWduZWRBcGsgPSBhd2FpdCB0ZW1wRGlyLnBhdGgoe3ByZWZpeDogJ2FwcGl1bScsIHN1ZmZpeDogJy50bXAnfSk7XG4gIGF3YWl0IG1rZGlycChwYXRoLmRpcm5hbWUoYWxpZ25lZEFwaykpO1xuICB0cnkge1xuICAgIGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy56aXBhbGlnbiwgWyctZicsICc0JywgYXBrLCBhbGlnbmVkQXBrXSk7XG4gICAgYXdhaXQgZnMubXYoYWxpZ25lZEFwaywgYXBrLCB7IG1rZGlycDogdHJ1ZSB9KTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmIChhd2FpdCBmcy5leGlzdHMoYWxpZ25lZEFwaykpIHtcbiAgICAgIGF3YWl0IGZzLnVubGluayhhbGlnbmVkQXBrKTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKGB6aXBBbGlnbkFwayBmYWlsZWQuIE9yaWdpbmFsIGVycm9yOiAke2Uuc3RkZXJyIHx8IGUubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBDZXJ0Q2hlY2tPcHRpb25zXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IHJlcXVpcmVEZWZhdWx0Q2VydCBbdHJ1ZV0gV2hldGhlciB0byByZXF1aXJlIHRoYXQgdGhlIGRlc3RpbmF0aW9uIEFQS1xuICogaXMgc2lnbmVkIHdpdGggdGhlIGRlZmF1bHQgQXBwaXVtIGNlcnRpZmljYXRlIG9yIGFueSB2YWxpZCBjZXJ0aWZpY2F0ZS4gVGhpcyBvcHRpb25cbiAqIG9ubHkgaGFzIGVmZmVjdCBpZiBgdXNlS2V5c3RvcmVgIHByb3BlcnR5IGlzIHVuc2V0LlxuICovXG5cbi8qKlxuICogQ2hlY2sgaWYgdGhlIGFwcCBpcyBhbHJlYWR5IHNpZ25lZCB3aXRoIHRoZSBkZWZhdWx0IEFwcGl1bSBjZXJ0aWZpY2F0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwUGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIGxvY2FsIC5hcGsocykgZmlsZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwZ2sgLSBUaGUgbmFtZSBvZiBhcHBsaWNhdGlvbiBwYWNrYWdlLlxuICogQHBhcmFtIHtDZXJ0Q2hlY2tPcHRpb25zfSBvcHRzIC0gQ2VydGlmaWNhdGUgY2hlY2tpbmcgb3B0aW9uc1xuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiBnaXZlbiBhcHBsaWNhdGlvbiBpcyBhbHJlYWR5IHNpZ25lZC5cbiAqL1xuYXBrU2lnbmluZ01ldGhvZHMuY2hlY2tBcGtDZXJ0ID0gYXN5bmMgZnVuY3Rpb24gY2hlY2tBcGtDZXJ0IChhcHBQYXRoLCBwa2csIG9wdHMgPSB7fSkge1xuICBsb2cuZGVidWcoYENoZWNraW5nIGFwcCBjZXJ0IGZvciAke2FwcFBhdGh9YCk7XG4gIGlmICghYXdhaXQgZnMuZXhpc3RzKGFwcFBhdGgpKSB7XG4gICAgbG9nLmRlYnVnKGAnJHthcHBQYXRofScgZG9lcyBub3QgZXhpc3RgKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAocGF0aC5leHRuYW1lKGFwcFBhdGgpID09PSBBUEtTX0VYVEVOU0lPTikge1xuICAgIGFwcFBhdGggPSBhd2FpdCB0aGlzLmV4dHJhY3RCYXNlQXBrKGFwcFBhdGgpO1xuICB9XG5cbiAgY29uc3QgaGFzaE1hdGNoZXMgPSAoYXBrc2lnbmVyT3V0cHV0LCBleHBlY3RlZEhhc2hlcykgPT4ge1xuICAgIGZvciAoY29uc3QgW25hbWUsIHZhbHVlXSBvZiBfLnRvUGFpcnMoZXhwZWN0ZWRIYXNoZXMpKSB7XG4gICAgICBpZiAobmV3IFJlZ0V4cChgZGlnZXN0OlxcXFxzKyR7dmFsdWV9XFxcXGJgLCAnaScpLnRlc3QoYXBrc2lnbmVyT3V0cHV0KSkge1xuICAgICAgICBsb2cuZGVidWcoYCR7bmFtZX0gaGFzaCBkaWQgbWF0Y2ggZm9yICcke3BhdGguYmFzZW5hbWUoYXBwUGF0aCl9J2ApO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIGNvbnN0IHtcbiAgICByZXF1aXJlRGVmYXVsdENlcnQgPSB0cnVlLFxuICB9ID0gb3B0cztcblxuICBjb25zdCBhcHBIYXNoID0gYXdhaXQgZnMuaGFzaChhcHBQYXRoKTtcbiAgaWYgKFNJR05FRF9BUFBTX0NBQ0hFLmhhcyhhcHBIYXNoKSkge1xuICAgIGxvZy5kZWJ1ZyhgVXNpbmcgdGhlIHByZXZpb3VzbHkgY2FjaGVkIHNpZ25hdHVyZSBlbnRyeSBmb3IgJyR7cGF0aC5iYXNlbmFtZShhcHBQYXRoKX0nYCk7XG4gICAgY29uc3Qge2tleXN0b3JlUGF0aCwgb3V0cHV0LCBleHBlY3RlZH0gPSBTSUdORURfQVBQU19DQUNIRS5nZXQoYXBwSGFzaCk7XG4gICAgaWYgKHRoaXMudXNlS2V5c3RvcmUgJiYgdGhpcy5rZXlzdG9yZVBhdGggPT09IGtleXN0b3JlUGF0aCB8fCAhdGhpcy51c2VLZXlzdG9yZSkge1xuICAgICAgcmV0dXJuICghdGhpcy51c2VLZXlzdG9yZSAmJiAhcmVxdWlyZURlZmF1bHRDZXJ0KSB8fCBoYXNoTWF0Y2hlcyhvdXRwdXQsIGV4cGVjdGVkKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBleHBlY3RlZCA9IHRoaXMudXNlS2V5c3RvcmVcbiAgICA/IGF3YWl0IHRoaXMuZ2V0S2V5c3RvcmVIYXNoKGFwcFBhdGgsIHBrZylcbiAgICA6IERFRkFVTFRfQ0VSVF9IQVNIO1xuICB0cnkge1xuICAgIGF3YWl0IGdldEFwa3NpZ25lckZvck9zKHRoaXMpO1xuICAgIGNvbnN0IG91dHB1dCA9IGF3YWl0IHRoaXMuZXhlY3V0ZUFwa3NpZ25lcihbJ3ZlcmlmeScsICctLXByaW50LWNlcnRzJywgYXBwUGF0aF0pO1xuICAgIGNvbnN0IGhhc01hdGNoID0gaGFzaE1hdGNoZXMob3V0cHV0LCBleHBlY3RlZCk7XG4gICAgaWYgKGhhc01hdGNoKSB7XG4gICAgICBsb2cuaW5mbyhgJyR7YXBwUGF0aH0nIGlzIHNpZ25lZCB3aXRoIHRoZSBgICtcbiAgICAgICAgYCR7dGhpcy51c2VLZXlzdG9yZSA/ICdrZXlzdG9yZScgOiAnZGVmYXVsdCd9IGNlcnRpZmljYXRlYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZy5pbmZvKGAnJHthcHBQYXRofScgaXMgc2lnbmVkIHdpdGggYSBgICtcbiAgICAgICAgYG5vbi0ke3RoaXMudXNlS2V5c3RvcmUgPyAna2V5c3RvcmUnIDogJ2RlZmF1bHQnfSBjZXJ0aWZpY2F0ZWApO1xuICAgIH1cbiAgICBjb25zdCBpc1NpZ25lZCA9ICghdGhpcy51c2VLZXlzdG9yZSAmJiAhcmVxdWlyZURlZmF1bHRDZXJ0KSB8fCBoYXNNYXRjaDtcbiAgICBpZiAoaXNTaWduZWQpIHtcbiAgICAgIFNJR05FRF9BUFBTX0NBQ0hFLnNldChhcHBIYXNoLCB7XG4gICAgICAgIG91dHB1dCxcbiAgICAgICAgZXhwZWN0ZWQsXG4gICAgICAgIGtleXN0b3JlUGF0aDogdGhpcy5rZXlzdG9yZVBhdGgsXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGlzU2lnbmVkO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICAvLyBjaGVjayBpZiB0aGVyZSBpcyBubyBzaWduYXR1cmVcbiAgICBpZiAoXy5pbmNsdWRlcyhlcnIuc3RkZXJyLCBBUEtTSUdORVJfVkVSSUZZX0ZBSUwpKSB7XG4gICAgICBsb2cuaW5mbyhgJyR7YXBwUGF0aH0nIGlzIG5vdCBzaWduZWRgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgZXJyTXNnID0gZXJyLnN0ZGVyciB8fCBlcnIuc3Rkb3V0IHx8IGVyci5tZXNzYWdlO1xuICAgIGlmIChfLmluY2x1ZGVzKGVyck1zZywgSkFWQV9QUk9QU19JTklUX0VSUk9SKSkge1xuICAgICAgLy8gVGhpcyBlcnJvciBwb3BzIHVwIHJhbmRvbWx5IGFuZCB3ZSBhcmUgbm90IHF1aXRlIHN1cmUgd2h5LlxuICAgICAgLy8gTXkgZ3Vlc3MgLSBhIHJhY2UgY29uZGl0aW9uIGluIGphdmEgdm0gaW5pdGlhbGl6YXRpb24uXG4gICAgICAvLyBOZXZlcnRoZWxlc3MsIGxldHMgbWFrZSBBcHBpdW0gdG8gYmVsaWV2ZSB0aGUgZmlsZSBpcyBhbHJlYWR5IHNpZ25lZCxcbiAgICAgIC8vIGJlY2F1c2UgaXQgd291bGQgYmUgdHJ1ZSBmb3IgOTklIG9mIFVJQXV0b21hdG9yMi1iYXNlZFxuICAgICAgLy8gdGVzdHMsIHdoZXJlIHdlIHByZXNpZ24gc2VydmVyIGJpbmFyaWVzIHdoaWxlIHB1Ymxpc2hpbmcgdGhlaXIgTlBNIG1vZHVsZS5cbiAgICAgIC8vIElmIHRoZXNlIGFyZSBub3Qgc2lnbmVkLCBlLmcuIGluIGNhc2Ugb2YgRXNwcmVzc28sIHRoZW4gdGhlIG5leHQgc3RlcChzKVxuICAgICAgLy8gd291bGQgYW55d2F5IGZhaWwuXG4gICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0vaXNzdWVzLzE0NzI0IGZvciBtb3JlIGRldGFpbHMuXG4gICAgICBsb2cud2FybihlcnJNc2cpO1xuICAgICAgbG9nLndhcm4oYEFzc3VtaW5nICcke2FwcFBhdGh9JyBpcyBhbHJlYWR5IHNpZ25lZCBhbmQgY29udGludWluZyBhbnl3YXlgKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCB2ZXJpZnkgdGhlIHNpZ25hdHVyZSBvZiAnJHthcHBQYXRofScuIGAgK1xuICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Vyck1zZ31gKTtcbiAgfVxufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBLZXlzdG9yZUhhc2hcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gbWQ1IHRoZSBtZDUgaGFzaCB2YWx1ZSBvZiB0aGUga2V5c3RvcmVcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gc2hhMSB0aGUgc2hhMSBoYXNoIHZhbHVlIG9mIHRoZSBrZXlzdG9yZVxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBzaGEyNTYgdGhlIHNoYTI1NiBoYXNoIHZhbHVlIG9mIHRoZSBrZXlzdG9yZVxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBzaGE1MTIgdGhlIHNoYTUxMiBoYXNoIHZhbHVlIG9mIHRoZSBrZXlzdG9yZVxuICovXG5cbi8qKlxuICogUmV0cmlldmUgdGhlIHRoZSBoYXNoIG9mIHRoZSBnaXZlbiBrZXlzdG9yZS5cbiAqXG4gKiBAcmV0dXJuIHtLZXlzdG9yZUhhc2h9XG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgZ2V0dGluZyBrZXlzdG9yZSBoYXNoIGZhaWxzLlxuICovXG5hcGtTaWduaW5nTWV0aG9kcy5nZXRLZXlzdG9yZUhhc2ggPSBhc3luYyBmdW5jdGlvbiBnZXRLZXlzdG9yZUhhc2ggKCkge1xuICBsb2cuZGVidWcoYEdldHRpbmcgaGFzaCBvZiB0aGUgJyR7dGhpcy5rZXlzdG9yZVBhdGh9JyBrZXlzdG9yZWApO1xuICBjb25zdCBrZXl0b29sID0gcGF0aC5yZXNvbHZlKGF3YWl0IGdldEphdmFIb21lKCksICdiaW4nLFxuICAgIGBrZXl0b29sJHtzeXN0ZW0uaXNXaW5kb3dzKCkgPyAnLmV4ZScgOiAnJ31gKTtcbiAgaWYgKCFhd2FpdCBmcy5leGlzdHMoa2V5dG9vbCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBrZXl0b29sIHV0aWxpdHkgY2Fubm90IGJlIGZvdW5kIGF0ICcke2tleXRvb2x9J2ApO1xuICB9XG4gIGNvbnN0IGFyZ3MgPSBbXG4gICAgJy12JywgJy1saXN0JyxcbiAgICAnLWFsaWFzJywgdGhpcy5rZXlBbGlhcyxcbiAgICAnLWtleXN0b3JlJywgdGhpcy5rZXlzdG9yZVBhdGgsXG4gICAgJy1zdG9yZXBhc3MnLCB0aGlzLmtleXN0b3JlUGFzc3dvcmRcbiAgXTtcbiAgbG9nLmluZm8oYFJ1bm5pbmcgJyR7a2V5dG9vbH0nIHdpdGggYXJndW1lbnRzOiAke3V0aWwucXVvdGUoYXJncyl9YCk7XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKGtleXRvb2wsIGFyZ3MsIHsgd2luZG93c1ZlcmJhdGltQXJndW1lbnRzOiBzeXN0ZW0uaXNXaW5kb3dzKCkgfSk7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgZm9yIChjb25zdCBoYXNoTmFtZSBvZiBbU0hBNTEyLCBTSEEyNTYsIFNIQTEsIE1ENV0pIHtcbiAgICAgIGNvbnN0IGhhc2hSZSA9IG5ldyBSZWdFeHAoYF5cXFxccyoke2hhc2hOYW1lfTpcXFxccyooW2EtZjAtOTpdKylgLCAnbWknKTtcbiAgICAgIGNvbnN0IG1hdGNoID0gaGFzaFJlLmV4ZWMoc3Rkb3V0KTtcbiAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICByZXN1bHRbaGFzaE5hbWVdID0gbWF0Y2hbMV0ucmVwbGFjZSgvOi9nLCAnJykudG9Mb3dlckNhc2UoKTtcbiAgICB9XG4gICAgaWYgKF8uaXNFbXB0eShyZXN1bHQpKSB7XG4gICAgICBsb2cuZGVidWcoc3Rkb3V0KTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHBhcnNlIHRoZSBoYXNoIHZhbHVlIGZyb20gdGhlIGtleXRvb2wgb3V0cHV0Jyk7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgS2V5c3RvcmUgaGFzaDogJHtKU09OLnN0cmluZ2lmeShyZXN1bHQpfWApO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBnZXQgdGhlIGhhc2ggb2YgJyR7dGhpcy5rZXlzdG9yZVBhdGh9JyBrZXlzdG9yZS4gYCArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5zdGRlcnIgfHwgZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBhcGtTaWduaW5nTWV0aG9kcztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUEsTUFBTUEsbUJBQW1CLEdBQUdDLGFBQUksQ0FBQ0MsT0FBTyxDQUFDLElBQUFDLHNCQUFhLEdBQUUsRUFBRSxNQUFNLEVBQUUsYUFBYSxDQUFDO0FBQ2hGLE1BQU1DLG1CQUFtQixHQUFHSCxhQUFJLENBQUNDLE9BQU8sQ0FBQyxJQUFBQyxzQkFBYSxHQUFFLEVBQUUsTUFBTSxFQUFFLGtCQUFrQixDQUFDO0FBQ3JGLE1BQU1FLG1CQUFtQixHQUFHLDhEQUE4RDtBQUMxRixNQUFNQyxxQkFBcUIsR0FBRyxpQkFBaUI7QUFDL0MsTUFBTUMsSUFBSSxHQUFHLE1BQU07QUFDbkIsTUFBTUMsTUFBTSxHQUFHLFFBQVE7QUFDdkIsTUFBTUMsTUFBTSxHQUFHLFFBQVE7QUFDdkIsTUFBTUMsR0FBRyxHQUFHLEtBQUs7QUFDakIsTUFBTUMsaUJBQWlCLEdBQUc7RUFDeEIsQ0FBQ0gsTUFBTSxHQUFHO0FBQ1osQ0FBQztBQUNELE1BQU1JLHFCQUFxQixHQUFHLGtDQUFrQztBQUNoRSxNQUFNQyxpQkFBaUIsR0FBRyxJQUFJQyxpQkFBRyxDQUFDO0VBQ2hDQyxHQUFHLEVBQUU7QUFDUCxDQUFDLENBQUM7QUFHRixNQUFNQyxpQkFBaUIsR0FBRyxDQUFDLENBQUM7O0FBVTVCQSxpQkFBaUIsQ0FB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