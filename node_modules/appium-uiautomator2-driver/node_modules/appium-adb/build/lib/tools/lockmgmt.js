"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _logger = _interopRequireDefault(require("../logger.js"));
var _path = _interopRequireDefault(require("path"));
var _lodash = _interopRequireDefault(require("lodash"));
var _support = require("@appium/support");
var _helpers = require("../helpers.js");
var _bluebird = _interopRequireDefault(require("bluebird"));
const lockManagementMethods = {};
const CREDENTIAL_CANNOT_BE_NULL_OR_EMPTY_ERROR = `Credential can't be null or empty`;
const CREDENTIAL_DID_NOT_MATCH_ERROR = `didn't match`;
const SUPPORTED_LOCK_CREDENTIAL_TYPES = ['password', 'pin', 'pattern'];
const KEYCODE_POWER = 26;
const KEYCODE_WAKEUP = 224;
const HIDE_KEYBOARD_WAIT_TIME = 100;
function buildCommand(verb, oldCredential = null, ...args) {
  const cmd = ['locksettings', verb];
  if (!_lodash.default.isEmpty(oldCredential)) {
    cmd.push('--old', oldCredential);
  }
  if (!_lodash.default.isEmpty(args)) {
    cmd.push(...args);
  }
  return cmd;
}
async function swipeUp(adb) {
  const output = await adb.shell(['dumpsys', 'window']);
  const dimensionsMatch = /init=(\d+)x(\d+)/.exec(output);
  if (!dimensionsMatch) {
    throw new Error('Cannot retrieve the display size');
  }
  const displayWidth = parseInt(dimensionsMatch[1], 10);
  const displayHeight = parseInt(dimensionsMatch[2], 10);
  const x0 = displayWidth / 2;
  const y0 = displayHeight / 5 * 4;
  const x1 = x0;
  const y1 = displayHeight / 5;
  await adb.shell(['input', 'touchscreen', 'swipe', ...[x0, y0, x1, y1].map(c => Math.trunc(c))]);
}

lockManagementMethods.isLockManagementSupported = async function isLockManagementSupported() {
  if (!_lodash.default.isBoolean(this._isLockManagementSupported)) {
    const passFlag = '__PASS__';
    let output = '';
    try {
      output = await this.shell([`locksettings help && echo ${passFlag}`]);
    } catch (ign) {}
    this._isLockManagementSupported = _lodash.default.includes(output, passFlag);
    _logger.default.debug(`Extended lock settings management is ` + `${this._isLockManagementSupported ? '' : 'not '}supported`);
  }
  return this._isLockManagementSupported;
};

lockManagementMethods.verifyLockCredential = async function verifyLockCredential(credential = null) {
  try {
    const {
      stdout,
      stderr
    } = await this.shell(buildCommand('verify', credential), {
      outputFormat: this.EXEC_OUTPUT_FORMAT.FULL
    });
    if (_lodash.default.includes(stdout, 'verified successfully')) {
      return true;
    }
    if ([`didn't match`, CREDENTIAL_CANNOT_BE_NULL_OR_EMPTY_ERROR].some(x => _lodash.default.includes(stderr || stdout, x))) {
      return false;
    }
    throw new Error(stderr || stdout);
  } catch (e) {
    throw new Error(`Device lock credential verification failed. ` + `Original error: ${e.stderr || e.stdout || e.message}`);
  }
};

lockManagementMethods.clearLockCredential = async function clearLockCredential(credential = null) {
  try {
    const {
      stdout,
      stderr
    } = await this.shell(buildCommand('clear', credential), {
      outputFormat: this.EXEC_OUTPUT_FORMAT.FULL
    });
    if (!['user has no password', 'Lock credential cleared'].some(x => _lodash.default.includes(stderr || stdout, x))) {
      throw new Error(stderr || stdout);
    }
  } catch (e) {
    throw new Error(`Cannot clear device lock credential. ` + `Original error: ${e.stderr || e.stdout || e.message}`);
  }
};

lockManagementMethods.isLockEnabled = async function isLockEnabled() {
  try {
    const {
      stdout,
      stderr
    } = await this.shell(buildCommand('get-disabled'), {
      outputFormat: this.EXEC_OUTPUT_FORMAT.FULL
    });
    if (/\bfalse\b/.test(stdout) || [CREDENTIAL_DID_NOT_MATCH_ERROR, CREDENTIAL_CANNOT_BE_NULL_OR_EMPTY_ERROR].some(x => _lodash.default.includes(stderr || stdout, x))) {
      return true;
    }
    if (/\btrue\b/.test(stdout)) {
      return false;
    }
    throw new Error(stderr || stdout);
  } catch (e) {
    throw new Error(`Cannot check if device lock is enabled. Original error: ${e.message}`);
  }
};

lockManagementMethods.setLockCredential = async function setLockCredential(credentialType, credential, oldCredential = null) {
  if (!SUPPORTED_LOCK_CREDENTIAL_TYPES.includes(credentialType)) {
    throw new Error(`Device lock credential type '${credentialType}' is unknown. ` + `Only the following credential types are supported: ${SUPPORTED_LOCK_CREDENTIAL_TYPES}`);
  }
  if (_lodash.default.isEmpty(credential) && !_lodash.default.isInteger(credential)) {
    throw new Error('Device lock credential cannot be empty');
  }
  const cmd = buildCommand(`set-${credentialType}`, oldCredential, credential);
  try {
    const {
      stdout,
      stderr
    } = await this.shell(cmd, {
      outputFormat: this.EXEC_OUTPUT_FORMAT.FULL
    });
    if (!_lodash.default.includes(stdout, 'set to')) {
      throw new Error(stderr || stdout);
    }
  } catch (e) {
    throw new Error(`Setting of device lock ${credentialType} credential failed. ` + `Original error: ${e.stderr || e.stdout || e.message}`);
  }
};

lockManagementMethods.isScreenLocked = async function isScreenLocked() {
  const stdout = await this.shell(['dumpsys', 'window']);
  if (process.env.APPIUM_LOG_DUMPSYS) {
    const dumpsysFile = _path.default.resolve(process.cwd(), 'dumpsys.log');
    _logger.default.debug(`Writing dumpsys output to ${dumpsysFile}`);
    await _support.fs.writeFile(dumpsysFile, stdout);
  }
  return (0, _helpers.isShowingLockscreen)(stdout) || (0, _helpers.isCurrentFocusOnKeyguard)(stdout) || !(0, _helpers.isScreenOnFully)(stdout);
};

lockManagementMethods.dismissKeyguard = async function dismissKeyguard() {
  _logger.default.info('Waking up the device to dismiss the keyguard');
  await this.cycleWakeUp();
  if ((await this.getApiLevel()) > 21) {
    await this.shell(['wm', 'dismiss-keyguard']);
    return;
  }
  const stdout = await this.shell(['dumpsys', 'window', 'windows']);
  if (!(0, _helpers.isCurrentFocusOnKeyguard)(stdout)) {
    _logger.default.debug('The keyguard seems to be inactive');
    return;
  }
  _logger.default.debug('Swiping up to dismiss the keyguard');
  if (await this.hideKeyboard()) {
    await _bluebird.default.delay(HIDE_KEYBOARD_WAIT_TIME);
  }
  _logger.default.debug('Dismissing notifications from the unlock view');
  await this.shell(['service', 'call', 'notification', '1']);
  await this.back();
  await swipeUp(this);
};

lockManagementMethods.cycleWakeUp = async function cycleWakeUp() {
  await this.keyevent(KEYCODE_POWER);
  await this.keyevent(KEYCODE_WAKEUP);
};
var _default = lockManagementMethods;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJsb2NrTWFuYWdlbWVudE1ldGhvZHMiLCJDUkVERU5USUFMX0NBTk5PVF9CRV9OVUxMX09SX0VNUFRZX0VSUk9SIiwiQ1JFREVOVElBTF9ESURfTk9UX01BVENIX0VSUk9SIiwiU1VQUE9SVEVEX0xPQ0tfQ1JFREVOVElBTF9UWVBFUyIsIktFWUNPREVfUE9XRVIiLCJLRVlDT0RFX1dBS0VVUCIsIkhJREVfS0VZQk9BUkRfV0FJVF9USU1FIiwiYnVpbGRDb21tYW5kIiwidmVyYiIsIm9sZENyZWRlbnRpYWwiLCJhcmdzIiwiY21kIiwiXyIsImlzRW1wdHkiLCJwdXNoIiwic3dpcGVVcCIsImFkYiIsIm91dHB1dCIsInNoZWxsIiwiZGltZW5zaW9uc01hdGNoIiwiZXhlYyIsIkVycm9yIiwiZGlzcGxheVdpZHRoIiwicGFyc2VJbnQiLCJkaXNwbGF5SGVpZ2h0IiwieDAiLCJ5MCIsIngxIiwieTEiLCJtYXAiLCJjIiwiTWF0aCIsInRydW5jIiwiaXNMb2NrTWFuYWdlbWVudFN1cHBvcnRlZCIsImlzQm9vbGVhbiIsIl9pc0xvY2tNYW5hZ2VtZW50U3VwcG9ydGVkIiwicGFzc0ZsYWciLCJpZ24iLCJpbmNsdWRlcyIsImxvZyIsImRlYnVnIiwidmVyaWZ5TG9ja0NyZWRlbnRpYWwiLCJjcmVkZW50aWFsIiwic3Rkb3V0Iiwic3RkZXJyIiwib3V0cHV0Rm9ybWF0IiwiRVhFQ19PVVRQVVRfRk9STUFUIiwiRlVMTCIsInNvbWUiLCJ4IiwiZSIsIm1lc3NhZ2UiLCJjbGVhckxvY2tDcmVkZW50aWFsIiwiaXNMb2NrRW5hYmxlZCIsInRlc3QiLCJzZXRMb2NrQ3JlZGVudGlhbCIsImNyZWRlbnRpYWxUeXBlIiwiaXNJbnRlZ2VyIiwiaXNTY3JlZW5Mb2NrZWQiLCJwcm9jZXNzIiwiZW52IiwiQVBQSVVNX0xPR19EVU1QU1lTIiwiZHVtcHN5c0ZpbGUiLCJwYXRoIiwicmVzb2x2ZSIsImN3ZCIsImZzIiwid3JpdGVGaWxlIiwiaXNTaG93aW5nTG9ja3NjcmVlbiIsImlzQ3VycmVudEZvY3VzT25LZXlndWFyZCIsImlzU2NyZWVuT25GdWxseSIsImRpc21pc3NLZXlndWFyZCIsImluZm8iLCJjeWNsZVdha2VVcCIsImdldEFwaUxldmVsIiwiaGlkZUtleWJvYXJkIiwiQiIsImRlbGF5IiwiYmFjayIsImtleWV2ZW50Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL3Rvb2xzL2xvY2ttZ210LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyLmpzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGZzIH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcbmltcG9ydCB7XG4gIGlzU2hvd2luZ0xvY2tzY3JlZW4sIGlzQ3VycmVudEZvY3VzT25LZXlndWFyZCwgaXNTY3JlZW5PbkZ1bGx5LFxufSBmcm9tICcuLi9oZWxwZXJzLmpzJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcblxuY29uc3QgbG9ja01hbmFnZW1lbnRNZXRob2RzID0ge307XG5cbmNvbnN0IENSRURFTlRJQUxfQ0FOTk9UX0JFX05VTExfT1JfRU1QVFlfRVJST1IgPSBgQ3JlZGVudGlhbCBjYW4ndCBiZSBudWxsIG9yIGVtcHR5YDtcbmNvbnN0IENSRURFTlRJQUxfRElEX05PVF9NQVRDSF9FUlJPUiA9IGBkaWRuJ3QgbWF0Y2hgO1xuY29uc3QgU1VQUE9SVEVEX0xPQ0tfQ1JFREVOVElBTF9UWVBFUyA9IFsncGFzc3dvcmQnLCAncGluJywgJ3BhdHRlcm4nXTtcbmNvbnN0IEtFWUNPREVfUE9XRVIgPSAyNjtcbmNvbnN0IEtFWUNPREVfV0FLRVVQID0gMjI0OyAvLyB3b3JrcyBvdmVyIEFQSSBMZXZlbCAyMFxuY29uc3QgSElERV9LRVlCT0FSRF9XQUlUX1RJTUUgPSAxMDA7XG5cbmZ1bmN0aW9uIGJ1aWxkQ29tbWFuZCAodmVyYiwgb2xkQ3JlZGVudGlhbCA9IG51bGwsIC4uLmFyZ3MpIHtcbiAgY29uc3QgY21kID0gWydsb2Nrc2V0dGluZ3MnLCB2ZXJiXTtcbiAgaWYgKCFfLmlzRW1wdHkob2xkQ3JlZGVudGlhbCkpIHtcbiAgICBjbWQucHVzaCgnLS1vbGQnLCBvbGRDcmVkZW50aWFsKTtcbiAgfVxuICBpZiAoIV8uaXNFbXB0eShhcmdzKSkge1xuICAgIGNtZC5wdXNoKC4uLmFyZ3MpO1xuICB9XG4gIHJldHVybiBjbWQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN3aXBlVXAgKGFkYikge1xuICBjb25zdCBvdXRwdXQgPSBhd2FpdCBhZGIuc2hlbGwoWydkdW1wc3lzJywgJ3dpbmRvdyddKTtcbiAgY29uc3QgZGltZW5zaW9uc01hdGNoID0gL2luaXQ9KFxcZCspeChcXGQrKS8uZXhlYyhvdXRwdXQpO1xuICBpZiAoIWRpbWVuc2lvbnNNYXRjaCkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHJldHJpZXZlIHRoZSBkaXNwbGF5IHNpemUnKTtcbiAgfVxuICBjb25zdCBkaXNwbGF5V2lkdGggPSBwYXJzZUludChkaW1lbnNpb25zTWF0Y2hbMV0sIDEwKTtcbiAgY29uc3QgZGlzcGxheUhlaWdodCA9IHBhcnNlSW50KGRpbWVuc2lvbnNNYXRjaFsyXSwgMTApO1xuICBjb25zdCB4MCA9IGRpc3BsYXlXaWR0aCAvIDI7XG4gIGNvbnN0IHkwID0gZGlzcGxheUhlaWdodCAvIDUgKiA0O1xuICBjb25zdCB4MSA9IHgwO1xuICBjb25zdCB5MSA9IGRpc3BsYXlIZWlnaHQgLyA1O1xuICBhd2FpdCBhZGIuc2hlbGwoW1xuICAgICdpbnB1dCcsICd0b3VjaHNjcmVlbicsICdzd2lwZScsXG4gICAgLi4uKFt4MCwgeTAsIHgxLCB5MV0ubWFwKChjKSA9PiBNYXRoLnRydW5jKGMpKSlcbiAgXSk7XG59XG5cbi8qKlxuICogQ2hlY2sgd2hldGhlciB0aGUgZGV2aWNlIHN1cHBvcnRzIGxvY2sgc2V0dGluZ3MgbWFuYWdlbWVudCB3aXRoIGBsb2Nrc2V0dGluZ3NgXG4gKiBjb21tYW5kIGxpbmUgdG9vbC4gVGhpcyB0b29sIGhhcyBiZWVuIGFkZGVkIHRvIEFuZHJvaWQgdG9vbHNldCBzaW5jZSAgQVBJIDI3IE9yZW9cbiAqXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBtYW5hZ2VtZW50IGlzIHN1cHBvcnRlZC4gVGhlIHJlc3VsdCBpcyBjYWNoZWQgcGVyIEFEQiBpbnN0YW5jZVxuICovXG5sb2NrTWFuYWdlbWVudE1ldGhvZHMuaXNMb2NrTWFuYWdlbWVudFN1cHBvcnRlZCA9IGFzeW5jIGZ1bmN0aW9uIGlzTG9ja01hbmFnZW1lbnRTdXBwb3J0ZWQgKCkge1xuICBpZiAoIV8uaXNCb29sZWFuKHRoaXMuX2lzTG9ja01hbmFnZW1lbnRTdXBwb3J0ZWQpKSB7XG4gICAgY29uc3QgcGFzc0ZsYWcgPSAnX19QQVNTX18nO1xuICAgIGxldCBvdXRwdXQgPSAnJztcbiAgICB0cnkge1xuICAgICAgb3V0cHV0ID0gYXdhaXQgdGhpcy5zaGVsbChbYGxvY2tzZXR0aW5ncyBoZWxwICYmIGVjaG8gJHtwYXNzRmxhZ31gXSk7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICAgIHRoaXMuX2lzTG9ja01hbmFnZW1lbnRTdXBwb3J0ZWQgPSBfLmluY2x1ZGVzKG91dHB1dCwgcGFzc0ZsYWcpO1xuICAgIGxvZy5kZWJ1ZyhgRXh0ZW5kZWQgbG9jayBzZXR0aW5ncyBtYW5hZ2VtZW50IGlzIGAgK1xuICAgICAgYCR7dGhpcy5faXNMb2NrTWFuYWdlbWVudFN1cHBvcnRlZCA/ICcnIDogJ25vdCAnfXN1cHBvcnRlZGApO1xuICB9XG4gIHJldHVybiB0aGlzLl9pc0xvY2tNYW5hZ2VtZW50U3VwcG9ydGVkO1xufTtcblxuLyoqXG4gKiBDaGVjayB3aGV0aGVyIHRoZSBnaXZlbiBjcmVkZW50aWFsIGlzIG1hdGNoZXMgdG8gdGhlIGN1cnJlbnRseSBzZXQgb25lLlxuICpcbiAqIEBwYXJhbSB7P3N0cmluZ30gY3JlZGVudGlhbCBbbnVsbF0gVGhlIGNyZWRlbnRpYWwgdmFsdWUuIEl0IGNvdWxkIGJlIGVpdGhlclxuICogcGluLCBwYXNzd29yZCBvciBhIHBhdHRlcm4uIEEgcGF0dGVybiBpcyBzcGVjaWZpZWQgYnkgYSBub24tc2VwYXJhdGVkIGxpc3RcbiAqIG9mIG51bWJlcnMgdGhhdCBpbmRleCB0aGUgY2VsbCBvbiB0aGUgcGF0dGVybiBpbiBhIDEtYmFzZWQgbWFubmVyIGluIGxlZnRcbiAqIHRvIHJpZ2h0IGFuZCB0b3AgdG8gYm90dG9tIG9yZGVyLCBpLmUuIHRoZSB0b3AtbGVmdCBjZWxsIGlzIGluZGV4ZWQgd2l0aCAxLFxuICogd2hlcmVhcyB0aGUgYm90dG9tLXJpZ2h0IGNlbGwgaXMgaW5kZXhlZCB3aXRoIDkuIEV4YW1wbGU6IDEyMzQuXG4gKiBudWxsL2VtcHR5IHZhbHVlIGFzc3VtZXMgdGhlIGRldmljZSBoYXMgbm8gbG9jayBjdXJyZW50bHkgc2V0LlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgZ2l2ZW4gY3JlZGVudGlhbCBtYXRjaGVzIHRvIHRoZSBkZXZpY2UncyBvbmVcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgdmVyaWZpY2F0aW9uIGZhY2VzIGFuIHVuZXhwZWN0ZWQgZXJyb3JcbiAqL1xubG9ja01hbmFnZW1lbnRNZXRob2RzLnZlcmlmeUxvY2tDcmVkZW50aWFsID0gYXN5bmMgZnVuY3Rpb24gdmVyaWZ5TG9ja0NyZWRlbnRpYWwgKGNyZWRlbnRpYWwgPSBudWxsKSB7XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dCwgc3RkZXJyfSA9IGF3YWl0IHRoaXMuc2hlbGwoYnVpbGRDb21tYW5kKCd2ZXJpZnknLCBjcmVkZW50aWFsKSwge1xuICAgICAgb3V0cHV0Rm9ybWF0OiB0aGlzLkVYRUNfT1VUUFVUX0ZPUk1BVC5GVUxMXG4gICAgfSk7XG4gICAgaWYgKF8uaW5jbHVkZXMoc3Rkb3V0LCAndmVyaWZpZWQgc3VjY2Vzc2Z1bGx5JykpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoW2BkaWRuJ3QgbWF0Y2hgLCBDUkVERU5USUFMX0NBTk5PVF9CRV9OVUxMX09SX0VNUFRZX0VSUk9SXVxuICAgICAgICAuc29tZSgoeCkgPT4gXy5pbmNsdWRlcyhzdGRlcnIgfHwgc3Rkb3V0LCB4KSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKHN0ZGVyciB8fCBzdGRvdXQpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBEZXZpY2UgbG9jayBjcmVkZW50aWFsIHZlcmlmaWNhdGlvbiBmYWlsZWQuIGAgK1xuICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Uuc3RkZXJyIHx8IGUuc3Rkb3V0IHx8IGUubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuLyoqXG4gKiBDbGVhcnMgY3VycmVudCBsb2NrIGNyZWRlbnRpYWxzLiBVc3VhbGx5IGl0IHRha2VzIHNldmVyYWwgc2Vjb25kcyBmb3IgYSBkZXZpY2UgdG9cbiAqIHN5bmMgdGhlIGNyZWRlbnRpYWwgc3RhdGUgYWZ0ZXIgdGhpcyBtZXRob2QgcmV0dXJucy5cbiAqXG4gKiBAcGFyYW0gez9zdHJpbmd9IGNyZWRlbnRpYWwgW251bGxdIFRoZSBjcmVkZW50aWFsIHZhbHVlLiBJdCBjb3VsZCBiZSBlaXRoZXJcbiAqIHBpbiwgcGFzc3dvcmQgb3IgYSBwYXR0ZXJuLiBBIHBhdHRlcm4gaXMgc3BlY2lmaWVkIGJ5IGEgbm9uLXNlcGFyYXRlZCBsaXN0XG4gKiBvZiBudW1iZXJzIHRoYXQgaW5kZXggdGhlIGNlbGwgb24gdGhlIHBhdHRlcm4gaW4gYSAxLWJhc2VkIG1hbm5lciBpbiBsZWZ0XG4gKiB0byByaWdodCBhbmQgdG9wIHRvIGJvdHRvbSBvcmRlciwgaS5lLiB0aGUgdG9wLWxlZnQgY2VsbCBpcyBpbmRleGVkIHdpdGggMSxcbiAqIHdoZXJlYXMgdGhlIGJvdHRvbS1yaWdodCBjZWxsIGlzIGluZGV4ZWQgd2l0aCA5LiBFeGFtcGxlOiAxMjM0LlxuICogbnVsbC9lbXB0eSB2YWx1ZSBhc3N1bWVzIHRoZSBkZXZpY2UgaGFzIG5vIGxvY2sgY3VycmVudGx5IHNldC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBvcGVyYXRpb24gZmFjZXMgYW4gdW5leHBlY3RlZCBlcnJvclxuICovXG5sb2NrTWFuYWdlbWVudE1ldGhvZHMuY2xlYXJMb2NrQ3JlZGVudGlhbCA9IGFzeW5jIGZ1bmN0aW9uIGNsZWFyTG9ja0NyZWRlbnRpYWwgKGNyZWRlbnRpYWwgPSBudWxsKSB7XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dCwgc3RkZXJyfSA9IGF3YWl0IHRoaXMuc2hlbGwoYnVpbGRDb21tYW5kKCdjbGVhcicsIGNyZWRlbnRpYWwpLCB7XG4gICAgICBvdXRwdXRGb3JtYXQ6IHRoaXMuRVhFQ19PVVRQVVRfRk9STUFULkZVTExcbiAgICB9KTtcbiAgICBpZiAoIVsndXNlciBoYXMgbm8gcGFzc3dvcmQnLCAnTG9jayBjcmVkZW50aWFsIGNsZWFyZWQnXVxuICAgICAgICAuc29tZSgoeCkgPT4gXy5pbmNsdWRlcyhzdGRlcnIgfHwgc3Rkb3V0LCB4KSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihzdGRlcnIgfHwgc3Rkb3V0KTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjbGVhciBkZXZpY2UgbG9jayBjcmVkZW50aWFsLiBgICtcbiAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLnN0ZGVyciB8fCBlLnN0ZG91dCB8fCBlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIGRldmljZSBpcyBsb2NrZWQgd2l0aCBhIGNyZWRlbnRpYWwgKGVpdGhlciBwaW4gb3IgYSBwYXNzd29yZFxuICogb3IgYSBwYXR0ZXJuKS5cbiAqXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gYHRydWVgIGlmIHRoZSBkZXZpY2UgaXMgbG9ja2VkXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgb3BlcmF0aW9uIGZhY2VzIGFuIHVuZXhwZWN0ZWQgZXJyb3JcbiAqL1xubG9ja01hbmFnZW1lbnRNZXRob2RzLmlzTG9ja0VuYWJsZWQgPSBhc3luYyBmdW5jdGlvbiBpc0xvY2tFbmFibGVkICgpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0LCBzdGRlcnJ9ID0gYXdhaXQgdGhpcy5zaGVsbChidWlsZENvbW1hbmQoJ2dldC1kaXNhYmxlZCcpLCB7XG4gICAgICBvdXRwdXRGb3JtYXQ6IHRoaXMuRVhFQ19PVVRQVVRfRk9STUFULkZVTExcbiAgICB9KTtcbiAgICBpZiAoL1xcYmZhbHNlXFxiLy50ZXN0KHN0ZG91dClcbiAgICAgICAgfHwgW0NSRURFTlRJQUxfRElEX05PVF9NQVRDSF9FUlJPUiwgQ1JFREVOVElBTF9DQU5OT1RfQkVfTlVMTF9PUl9FTVBUWV9FUlJPUl0uc29tZShcbiAgICAgICAgICAoeCkgPT4gXy5pbmNsdWRlcyhzdGRlcnIgfHwgc3Rkb3V0LCB4KSkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoL1xcYnRydWVcXGIvLnRlc3Qoc3Rkb3V0KSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3Ioc3RkZXJyIHx8IHN0ZG91dCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjaGVjayBpZiBkZXZpY2UgbG9jayBpcyBlbmFibGVkLiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogU2V0cyB0aGUgZGV2aWNlIGxvY2suXG4gKlxuICogQHBhcmFtIHshc3RyaW5nfSBjcmVkZW50aWFsVHlwZSBPbmUgb2Y6IHBhc3N3b3JkLCBwaW4sIHBhdHRlcm4uXG4gKiBAcGFyYW0geyFzdHJpbmd9IGNyZWRlbnRpYWwgQSBub24tZW1wdHkgY3JlZGVudGlhbCB2YWx1ZSB0byBiZSBzZXQuXG4gKiBNYWtlIHN1cmUgeW91ciBuZXcgY3JlZGVudGlhbCBtYXRjaGVzIHRvIHRoZSBhY3R1YWwgc3lzdGVtIHNlY3VyaXR5IHJlcXVpcmVtZW50cyxcbiAqIGUuZy4gYSBtaW5pbXVtIHBhc3N3b3JkIGxlbmd0aC4gQSBwYXR0ZXJuIGlzIHNwZWNpZmllZCBieSBhIG5vbi1zZXBhcmF0ZWQgbGlzdFxuICogb2YgbnVtYmVycyB0aGF0IGluZGV4IHRoZSBjZWxsIG9uIHRoZSBwYXR0ZXJuIGluIGEgMS1iYXNlZCBtYW5uZXIgaW4gbGVmdFxuICogdG8gcmlnaHQgYW5kIHRvcCB0byBib3R0b20gb3JkZXIsIGkuZS4gdGhlIHRvcC1sZWZ0IGNlbGwgaXMgaW5kZXhlZCB3aXRoIDEsXG4gKiB3aGVyZWFzIHRoZSBib3R0b20tcmlnaHQgY2VsbCBpcyBpbmRleGVkIHdpdGggOS4gRXhhbXBsZTogMTIzNC5cbiAqIEBwYXJhbSB7P3N0cmluZ30gb2xkQ3JlZGVudGlhbCBbbnVsbF0gQW4gb2xkIGNyZWRlbnRpYWwgc3RyaW5nLlxuICogSXQgaXMgb25seSByZXF1aXJlZCB0byBiZSBzZXQgaW4gY2FzZSB5b3UgbmVlZCB0byBjaGFuZ2UgdGhlIGN1cnJlbnRcbiAqIGNyZWRlbnRpYWwgcmF0aGVyIHRoYW4gdG8gc2V0IGEgbmV3IG9uZS4gU2V0dGluZyBpdCB0byBhIHdyb25nIHZhbHVlIHdpbGxcbiAqIG1ha2UgdGhpcyBtZXRob2QgdG8gZmFpbCBhbmQgdGhyb3cgYW4gZXhjZXB0aW9uLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhIGZhaWx1cmUgd2hpbGUgdmVyaWZ5aW5nIGlucHV0IGFyZ3VtZW50cyBvciBzZXR0aW5nXG4gKiB0aGUgY3JlZGVudGlhbFxuICovXG5sb2NrTWFuYWdlbWVudE1ldGhvZHMuc2V0TG9ja0NyZWRlbnRpYWwgPSBhc3luYyBmdW5jdGlvbiBzZXRMb2NrQ3JlZGVudGlhbCAoXG4gIGNyZWRlbnRpYWxUeXBlLCBjcmVkZW50aWFsLCBvbGRDcmVkZW50aWFsID0gbnVsbCkge1xuICBpZiAoIVNVUFBPUlRFRF9MT0NLX0NSRURFTlRJQUxfVFlQRVMuaW5jbHVkZXMoY3JlZGVudGlhbFR5cGUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBEZXZpY2UgbG9jayBjcmVkZW50aWFsIHR5cGUgJyR7Y3JlZGVudGlhbFR5cGV9JyBpcyB1bmtub3duLiBgICtcbiAgICAgIGBPbmx5IHRoZSBmb2xsb3dpbmcgY3JlZGVudGlhbCB0eXBlcyBhcmUgc3VwcG9ydGVkOiAke1NVUFBPUlRFRF9MT0NLX0NSRURFTlRJQUxfVFlQRVN9YCk7XG4gIH1cbiAgaWYgKF8uaXNFbXB0eShjcmVkZW50aWFsKSAmJiAhXy5pc0ludGVnZXIoY3JlZGVudGlhbCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0RldmljZSBsb2NrIGNyZWRlbnRpYWwgY2Fubm90IGJlIGVtcHR5Jyk7XG4gIH1cbiAgY29uc3QgY21kID0gYnVpbGRDb21tYW5kKGBzZXQtJHtjcmVkZW50aWFsVHlwZX1gLCBvbGRDcmVkZW50aWFsLCBjcmVkZW50aWFsKTtcbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0LCBzdGRlcnJ9ID0gYXdhaXQgdGhpcy5zaGVsbChjbWQsIHtcbiAgICAgIG91dHB1dEZvcm1hdDogdGhpcy5FWEVDX09VVFBVVF9GT1JNQVQuRlVMTFxuICAgIH0pO1xuICAgIGlmICghXy5pbmNsdWRlcyhzdGRvdXQsICdzZXQgdG8nKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHN0ZGVyciB8fCBzdGRvdXQpO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgU2V0dGluZyBvZiBkZXZpY2UgbG9jayAke2NyZWRlbnRpYWxUeXBlfSBjcmVkZW50aWFsIGZhaWxlZC4gYCArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5zdGRlcnIgfHwgZS5zdGRvdXQgfHwgZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG4vKipcbiAqIFJldHJpZXZlIHRoZSBzY3JlZW4gbG9jayBzdGF0ZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgZGV2aWNlIGlzIGxvY2tlZC5cbiAqL1xubG9ja01hbmFnZW1lbnRNZXRob2RzLmlzU2NyZWVuTG9ja2VkID0gYXN5bmMgZnVuY3Rpb24gaXNTY3JlZW5Mb2NrZWQgKCkge1xuICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFsnZHVtcHN5cycsICd3aW5kb3cnXSk7XG4gIGlmIChwcm9jZXNzLmVudi5BUFBJVU1fTE9HX0RVTVBTWVMpIHtcbiAgICAvLyBvcHRpb25hbCBkZWJ1Z2dpbmdcbiAgICAvLyBpZiB0aGUgbWV0aG9kIGlzIG5vdCB3b3JraW5nLCB0dXJuIGl0IG9uIGFuZCBzZW5kIHVzIHRoZSBvdXRwdXRcbiAgICBjb25zdCBkdW1wc3lzRmlsZSA9IHBhdGgucmVzb2x2ZShwcm9jZXNzLmN3ZCgpLCAnZHVtcHN5cy5sb2cnKTtcbiAgICBsb2cuZGVidWcoYFdyaXRpbmcgZHVtcHN5cyBvdXRwdXQgdG8gJHtkdW1wc3lzRmlsZX1gKTtcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUoZHVtcHN5c0ZpbGUsIHN0ZG91dCk7XG4gIH1cbiAgcmV0dXJuIGlzU2hvd2luZ0xvY2tzY3JlZW4oc3Rkb3V0KSB8fCBpc0N1cnJlbnRGb2N1c09uS2V5Z3VhcmQoc3Rkb3V0KSB8fCAhaXNTY3JlZW5PbkZ1bGx5KHN0ZG91dCk7XG59O1xuXG4vKipcbiAqIERpc21pc3NlcyBrZXlndWFyZCBvdmVybGF5LlxuICovXG5sb2NrTWFuYWdlbWVudE1ldGhvZHMuZGlzbWlzc0tleWd1YXJkID0gYXN5bmMgZnVuY3Rpb24gZGlzbWlzc0tleWd1YXJkICgpIHtcbiAgbG9nLmluZm8oJ1dha2luZyB1cCB0aGUgZGV2aWNlIHRvIGRpc21pc3MgdGhlIGtleWd1YXJkJyk7XG4gIC8vIFNjcmVlbiBvZmYgb25jZSB0byBmb3JjZSBwcmUtaW5wdXR0ZWQgdGV4dCBmaWVsZCBjbGVhbiBhZnRlciB3YWtlLXVwXG4gIC8vIEp1c3Qgc2NyZWVuIG9uIGlmIHRoZSBzY3JlZW4gZGVmYXVsdHMgb2ZmXG4gIGF3YWl0IHRoaXMuY3ljbGVXYWtlVXAoKTtcblxuICBpZiAoYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpID4gMjEpIHtcbiAgICBhd2FpdCB0aGlzLnNoZWxsKFsnd20nLCAnZGlzbWlzcy1rZXlndWFyZCddKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFsnZHVtcHN5cycsICd3aW5kb3cnLCAnd2luZG93cyddKTtcbiAgaWYgKCFpc0N1cnJlbnRGb2N1c09uS2V5Z3VhcmQoc3Rkb3V0KSkge1xuICAgIGxvZy5kZWJ1ZygnVGhlIGtleWd1YXJkIHNlZW1zIHRvIGJlIGluYWN0aXZlJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbG9nLmRlYnVnKCdTd2lwaW5nIHVwIHRvIGRpc21pc3MgdGhlIGtleWd1YXJkJyk7XG4gIGlmIChhd2FpdCB0aGlzLmhpZGVLZXlib2FyZCgpKSB7XG4gICAgYXdhaXQgQi5kZWxheShISURFX0tFWUJPQVJEX1dBSVRfVElNRSk7XG4gIH1cbiAgbG9nLmRlYnVnKCdEaXNtaXNzaW5nIG5vdGlmaWNhdGlvbnMgZnJvbSB0aGUgdW5sb2NrIHZpZXcnKTtcbiAgYXdhaXQgdGhpcy5zaGVsbChbJ3NlcnZpY2UnLCAnY2FsbCcsICdub3RpZmljYXRpb24nLCAnMSddKTtcbiAgYXdhaXQgdGhpcy5iYWNrKCk7XG4gIGF3YWl0IHN3aXBlVXAodGhpcyk7XG59O1xuXG4vKipcbiAqIFByZXNzZXMgdGhlIGNvcnJlc3BvbmRpbmcga2V5IGNvbWJpbmF0aW9uIHRvIG1ha2Ugc3VyZSB0aGUgZGV2aWNlJ3Mgc2NyZWVuXG4gKiBpcyBub3QgdHVybmVkIG9mZiBhbmQgaXMgbG9ja2VkIGlmIHRoZSBsYXR0ZXIgaXMgZW5hYmxlZC5cbiAqL1xubG9ja01hbmFnZW1lbnRNZXRob2RzLmN5Y2xlV2FrZVVwID0gYXN5bmMgZnVuY3Rpb24gY3ljbGVXYWtlVXAgKCkge1xuICBhd2FpdCB0aGlzLmtleWV2ZW50KEtFWUNPREVfUE9XRVIpO1xuICBhd2FpdCB0aGlzLmtleWV2ZW50KEtFWUNPREVfV0FLRVVQKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGxvY2tNYW5hZ2VtZW50TWV0aG9kcztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFFQSxNQUFNQSxxQkFBcUIsR0FBRyxDQUFDLENBQUM7QUFFaEMsTUFBTUMsd0NBQXdDLEdBQUksbUNBQWtDO0FBQ3BGLE1BQU1DLDhCQUE4QixHQUFJLGNBQWE7QUFDckQsTUFBTUMsK0JBQStCLEdBQUcsQ0FBQyxVQUFVLEVBQUUsS0FBSyxFQUFFLFNBQVMsQ0FBQztBQUN0RSxNQUFNQyxhQUFhLEdBQUcsRUFBRTtBQUN4QixNQUFNQyxjQUFjLEdBQUcsR0FBRztBQUMxQixNQUFNQyx1QkFBdUIsR0FBRyxHQUFHO0FBRW5DLFNBQVNDLFlBQVksQ0FBRUMsSUFBSSxFQUFFQyxhQUFhLEdBQUcsSUFBSSxFQUFFLEdBQUdDLElBQUksRUFBRTtFQUMxRCxNQUFNQyxHQUFHLEdBQUcsQ0FBQyxjQUFjLEVBQUVILElBQUksQ0FBQztFQUNsQyxJQUFJLENBQUNJLGVBQUMsQ0FBQ0MsT0FBTyxDQUFDSixhQUFhLENBQUMsRUFBRTtJQUM3QkUsR0FBRyxDQUFDRyxJQUFJLENBQUMsT0FBTyxFQUFFTCxhQUFhLENBQUM7RUFDbEM7RUFDQSxJQUFJLENBQUNHLGVBQUMsQ0FBQ0MsT0FBTyxDQUFDSCxJQUFJLENBQUMsRUFBRTtJQUNwQkMsR0FBRyxDQUFDRyxJQUFJLENBQUMsR0FBR0osSUFBSSxDQUFDO0VBQ25CO0VBQ0EsT0FBT0MsR0FBRztBQUNaO0FBRUEsZUFBZUksT0FBTyxDQUFFQyxHQUFHLEVBQUU7RUFDM0IsTUFBTUMsTUFBTSxHQUFHLE1BQU1ELEdBQUcsQ0FBQ0UsS0FBSyxDQUFDLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0VBQ3JELE1BQU1DLGVBQWUsR0FBRyxrQkFBa0IsQ0FBQ0MsSUFBSSxDQUFDSCxNQUFNLENBQUM7RUFDdkQsSUFB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