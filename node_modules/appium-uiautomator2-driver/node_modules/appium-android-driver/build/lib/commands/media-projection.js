"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;
require("source-map-support/register");
var _lodash = _interopRequireDefault(require("lodash"));
var _asyncbox = require("asyncbox");
var _support = require("appium/support");
var _path = _interopRequireDefault(require("path"));
var _bluebird = _interopRequireDefault(require("bluebird"));
var _androidHelpers = require("../android-helpers");
var _moment = _interopRequireDefault(require("moment"));
const commands = {};

exports.commands = commands;
const DEFAULT_EXT = '.mp4';
const RECORDING_STARTUP_TIMEOUT_MS = 3 * 1000;
const RECORDING_STOP_TIMEOUT_MS = 3 * 1000;
const MIN_API_LEVEL = 29;
const RECORDING_SERVICE_NAME = `${_androidHelpers.SETTINGS_HELPER_PKG_ID}/.recorder.RecorderService`;
const RECORDING_ACTIVITY_NAME = `${_androidHelpers.SETTINGS_HELPER_PKG_ID}/io.appium.settings.Settings`;
const RECORDING_ACTION_START = `${_androidHelpers.SETTINGS_HELPER_PKG_ID}.recording.ACTION_START`;
const RECORDING_ACTION_STOP = `${_androidHelpers.SETTINGS_HELPER_PKG_ID}.recording.ACTION_STOP`;
const RECORDINGS_ROOT = `/storage/emulated/0/Android/data/${_androidHelpers.SETTINGS_HELPER_PKG_ID}/files`;
const DEFAULT_FILENAME_FORMAT = 'YYYY-MM-DDTHH-mm-ss';
async function uploadRecordedMedia(localFile, remotePath = null, uploadOptions = {}) {
  if (_lodash.default.isEmpty(remotePath)) {
    return (await _support.util.toInMemoryBase64(localFile)).toString();
  }
  const {
    user,
    pass,
    method,
    headers,
    fileFieldName,
    formFields
  } = uploadOptions;
  const options = {
    method: method || 'PUT',
    headers,
    fileFieldName,
    formFields
  };
  if (user && pass) {
    options.auth = {
      user,
      pass
    };
  }
  await _support.net.uploadFile(localFile, remotePath, options);
  return '';
}
function adjustMediaExtension(name) {
  return _lodash.default.toLower(name).endsWith(DEFAULT_EXT) ? name : `${name}${DEFAULT_EXT}`;
}
async function verifyMediaProjectionRecordingIsSupported(adb) {
  const apiLevel = await adb.getApiLevel();
  if (apiLevel < MIN_API_LEVEL) {
    throw new Error(`Media projection-based recording is not available on API Level ${apiLevel}. ` + `Minimum required API Level is ${MIN_API_LEVEL}.`);
  }
}
class MediaProjectionRecorder {
  constructor(adb) {
    this.adb = adb;
  }
  async isRunning() {
    const stdout = await this.adb.shell(['dumpsys', 'activity', 'services', RECORDING_SERVICE_NAME]);
    return stdout.includes(RECORDING_SERVICE_NAME);
  }
  async start(opts = {}) {
    if (await this.isRunning()) {
      return false;
    }
    await this.cleanup();
    const {
      filename,
      maxDurationSec,
      priority,
      resolution
    } = opts;
    const args = ['am', 'start', '-n', RECORDING_ACTIVITY_NAME, '-a', RECORDING_ACTION_START];
    if (filename) {
      args.push('--es', 'filename', filename);
    }
    if (maxDurationSec) {
      args.push('--es', 'max_duration_sec', `${maxDurationSec}`);
    }
    if (priority) {
      args.push('--es', 'priority', priority);
    }
    if (resolution) {
      args.push('--es', 'resolution', resolution);
    }
    await this.adb.shell(args);
    await new _bluebird.default((resolve, reject) => {
      setTimeout(async () => {
        if (!(await this.isRunning())) {
          return reject(new Error(`The media projection recording is not running after ${RECORDING_STARTUP_TIMEOUT_MS}ms. ` + `Please check the logcat output for more details.`));
        }
        resolve();
      }, RECORDING_STARTUP_TIMEOUT_MS);
    });
    return true;
  }
  async cleanup() {
    await this.adb.shell([`rm -f ${RECORDINGS_ROOT}/*`]);
  }
  async pullRecent() {
    const recordings = await this.adb.ls(RECORDINGS_ROOT, ['-tr']);
    if (_lodash.default.isEmpty(recordings)) {
      return null;
    }
    const dstPath = _path.default.join(await _support.tempDir.openDir(), recordings[0]);
    await this.adb.pull(`${RECORDINGS_ROOT}/${recordings[0]}`, dstPath);
    return dstPath;
  }
  async stop() {
    if (!(await this.isRunning())) {
      return false;
    }
    await this.adb.shell(['am', 'start', '-n', RECORDING_ACTIVITY_NAME, '-a', RECORDING_ACTION_STOP]);
    try {
      await (0, _asyncbox.waitForCondition)(async () => !(await this.isRunning()), {
        waitMs: RECORDING_STOP_TIMEOUT_MS,
        intervalMs: 500
      });
    } catch (e) {
      throw new Error(`The attempt to stop the current media projection recording timed out after ` + `${RECORDING_STOP_TIMEOUT_MS}ms`);
    }
    return true;
  }
}

commands.mobileStartMediaProjectionRecording = async function mobileStartMediaProjectionRecording(options = {}) {
  await verifyMediaProjectionRecordingIsSupported(this.adb);
  const {
    resolution,
    priority,
    maxDurationSec,
    filename
  } = options;
  const recorder = new MediaProjectionRecorder(this.adb);
  const fname = adjustMediaExtension(filename || (0, _moment.default)().format(DEFAULT_FILENAME_FORMAT));
  const didStart = await recorder.start({
    resolution,
    priority,
    maxDurationSec,
    filename: fname
  });
  if (didStart) {
    this.log.info(`A new media projection recording '${fname}' has been successfully started`);
  } else {
    this.log.info('Another media projection recording is already in progress. There is nothing to start');
  }
  return didStart;
};

commands.mobileIsMediaProjectionRecordingRunning = async function mobileIsMediaProjectionRecordingRunning() {
  await verifyMediaProjectionRecordingIsSupported(this.adb);
  const recorder = new MediaProjectionRecorder(this.adb);
  return await recorder.isRunning();
};

commands.mobileStopMediaProjectionRecording = async function mobileStopMediaProjectionRecording(options = {}) {
  await verifyMediaProjectionRecordingIsSupported(this.adb);
  const recorder = new MediaProjectionRecorder(this.adb);
  if (await recorder.stop()) {
    this.log.info('Successfully stopped a media projection recording. Pulling the recorded media');
  } else {
    this.log.info('Media projection recording is not running. There is nothing to stop');
  }
  const recentRecordingPath = await recorder.pullRecent();
  if (!recentRecordingPath) {
    throw new Error(`No recent media projection recording have been found. Did you start any?`);
  }
  const {
    remotePath
  } = options;
  if (_lodash.default.isEmpty(remotePath)) {
    const {
      size
    } = await _support.fs.stat(recentRecordingPath);
    this.log.debug(`The size of the resulting media projection recording is ${_support.util.toReadableSizeString(size)}`);
  }
  try {
    return await uploadRecordedMedia(recentRecordingPath, remotePath, options);
  } finally {
    await _support.fs.rimraf(_path.default.dirname(recentRecordingPath));
  }
};
var _default = commands;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb21tYW5kcyIsIkRFRkFVTFRfRVhUIiwiUkVDT1JESU5HX1NUQVJUVVBfVElNRU9VVF9NUyIsIlJFQ09SRElOR19TVE9QX1RJTUVPVVRfTVMiLCJNSU5fQVBJX0xFVkVMIiwiUkVDT1JESU5HX1NFUlZJQ0VfTkFNRSIsIlNFVFRJTkdTX0hFTFBFUl9QS0dfSUQiLCJSRUNPUkRJTkdfQUNUSVZJVFlfTkFNRSIsIlJFQ09SRElOR19BQ1RJT05fU1RBUlQiLCJSRUNPUkRJTkdfQUNUSU9OX1NUT1AiLCJSRUNPUkRJTkdTX1JPT1QiLCJERUZBVUxUX0ZJTEVOQU1FX0ZPUk1BVCIsInVwbG9hZFJlY29yZGVkTWVkaWEiLCJsb2NhbEZpbGUiLCJyZW1vdGVQYXRoIiwidXBsb2FkT3B0aW9ucyIsIl8iLCJpc0VtcHR5IiwidXRpbCIsInRvSW5NZW1vcnlCYXNlNjQiLCJ0b1N0cmluZyIsInVzZXIiLCJwYXNzIiwibWV0aG9kIiwiaGVhZGVycyIsImZpbGVGaWVsZE5hbWUiLCJmb3JtRmllbGRzIiwib3B0aW9ucyIsImF1dGgiLCJuZXQiLCJ1cGxvYWRGaWxlIiwiYWRqdXN0TWVkaWFFeHRlbnNpb24iLCJuYW1lIiwidG9Mb3dlciIsImVuZHNXaXRoIiwidmVyaWZ5TWVkaWFQcm9qZWN0aW9uUmVjb3JkaW5nSXNTdXBwb3J0ZWQiLCJhZGIiLCJhcGlMZXZlbCIsImdldEFwaUxldmVsIiwiRXJyb3IiLCJNZWRpYVByb2plY3Rpb25SZWNvcmRlciIsImNvbnN0cnVjdG9yIiwiaXNSdW5uaW5nIiwic3Rkb3V0Iiwic2hlbGwiLCJpbmNsdWRlcyIsInN0YXJ0Iiwib3B0cyIsImNsZWFudXAiLCJmaWxlbmFtZSIsIm1heER1cmF0aW9uU2VjIiwicHJpb3JpdHkiLCJyZXNvbHV0aW9uIiwiYXJncyIsInB1c2giLCJCIiwicmVzb2x2ZSIsInJlamVjdCIsInNldFRpbWVvdXQiLCJwdWxsUmVjZW50IiwicmVjb3JkaW5ncyIsImxzIiwiZHN0UGF0aCIsInBhdGgiLCJqb2luIiwidGVtcERpciIsIm9wZW5EaXIiLCJwdWxsIiwic3RvcCIsIndhaXRGb3JDb25kaXRpb24iLCJ3YWl0TXMiLCJpbnRlcnZhbE1zIiwiZSIsIm1vYmlsZVN0YXJ0TWVkaWFQcm9qZWN0aW9uUmVjb3JkaW5nIiwicmVjb3JkZXIiLCJmbmFtZSIsIm1vbWVudCIsImZvcm1hdCIsImRpZFN0YXJ0IiwibG9nIiwiaW5mbyIsIm1vYmlsZUlzTWVkaWFQcm9qZWN0aW9uUmVjb3JkaW5nUnVubmluZyIsIm1vYmlsZVN0b3BNZWRpYVByb2plY3Rpb25SZWNvcmRpbmciLCJyZWNlbnRSZWNvcmRpbmdQYXRoIiwic2l6ZSIsImZzIiwic3RhdCIsImRlYnVnIiwidG9SZWFkYWJsZVNpemVTdHJpbmciLCJyaW1yYWYiLCJkaXJuYW1lIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2NvbW1hbmRzL21lZGlhLXByb2plY3Rpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IHdhaXRGb3JDb25kaXRpb24gfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgeyB1dGlsLCBmcywgbmV0LCB0ZW1wRGlyIH0gZnJvbSAnYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBTRVRUSU5HU19IRUxQRVJfUEtHX0lEIH0gZnJvbSAnLi4vYW5kcm9pZC1oZWxwZXJzJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcblxuXG5jb25zdCBjb21tYW5kcyA9IHt9O1xuXG4vLyBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2lvLmFwcGl1bS5zZXR0aW5ncyNpbnRlcm5hbC1hdWRpby0tdmlkZW8tcmVjb3JkaW5nXG5jb25zdCBERUZBVUxUX0VYVCA9ICcubXA0JztcbmNvbnN0IFJFQ09SRElOR19TVEFSVFVQX1RJTUVPVVRfTVMgPSAzICogMTAwMDtcbmNvbnN0IFJFQ09SRElOR19TVE9QX1RJTUVPVVRfTVMgPSAzICogMTAwMDtcbmNvbnN0IE1JTl9BUElfTEVWRUwgPSAyOTtcbmNvbnN0IFJFQ09SRElOR19TRVJWSUNFX05BTUUgPSBgJHtTRVRUSU5HU19IRUxQRVJfUEtHX0lEfS8ucmVjb3JkZXIuUmVjb3JkZXJTZXJ2aWNlYDtcbmNvbnN0IFJFQ09SRElOR19BQ1RJVklUWV9OQU1FID0gYCR7U0VUVElOR1NfSEVMUEVSX1BLR19JRH0vaW8uYXBwaXVtLnNldHRpbmdzLlNldHRpbmdzYDtcbmNvbnN0IFJFQ09SRElOR19BQ1RJT05fU1RBUlQgPSBgJHtTRVRUSU5HU19IRUxQRVJfUEtHX0lEfS5yZWNvcmRpbmcuQUNUSU9OX1NUQVJUYDtcbmNvbnN0IFJFQ09SRElOR19BQ1RJT05fU1RPUCA9IGAke1NFVFRJTkdTX0hFTFBFUl9QS0dfSUR9LnJlY29yZGluZy5BQ1RJT05fU1RPUGA7XG5jb25zdCBSRUNPUkRJTkdTX1JPT1QgPSBgL3N0b3JhZ2UvZW11bGF0ZWQvMC9BbmRyb2lkL2RhdGEvJHtTRVRUSU5HU19IRUxQRVJfUEtHX0lEfS9maWxlc2A7XG5jb25zdCBERUZBVUxUX0ZJTEVOQU1FX0ZPUk1BVCA9ICdZWVlZLU1NLUREVEhILW1tLXNzJztcblxuXG5hc3luYyBmdW5jdGlvbiB1cGxvYWRSZWNvcmRlZE1lZGlhIChsb2NhbEZpbGUsIHJlbW90ZVBhdGggPSBudWxsLCB1cGxvYWRPcHRpb25zID0ge30pIHtcbiAgaWYgKF8uaXNFbXB0eShyZW1vdGVQYXRoKSkge1xuICAgIHJldHVybiAoYXdhaXQgdXRpbC50b0luTWVtb3J5QmFzZTY0KGxvY2FsRmlsZSkpLnRvU3RyaW5nKCk7XG4gIH1cblxuICBjb25zdCB7dXNlciwgcGFzcywgbWV0aG9kLCBoZWFkZXJzLCBmaWxlRmllbGROYW1lLCBmb3JtRmllbGRzfSA9IHVwbG9hZE9wdGlvbnM7XG4gIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgbWV0aG9kOiBtZXRob2QgfHwgJ1BVVCcsXG4gICAgaGVhZGVycyxcbiAgICBmaWxlRmllbGROYW1lLFxuICAgIGZvcm1GaWVsZHMsXG4gIH07XG4gIGlmICh1c2VyICYmIHBhc3MpIHtcbiAgICBvcHRpb25zLmF1dGggPSB7dXNlciwgcGFzc307XG4gIH1cbiAgYXdhaXQgbmV0LnVwbG9hZEZpbGUobG9jYWxGaWxlLCByZW1vdGVQYXRoLCBvcHRpb25zKTtcbiAgcmV0dXJuICcnO1xufVxuXG5mdW5jdGlvbiBhZGp1c3RNZWRpYUV4dGVuc2lvbiAobmFtZSkge1xuICByZXR1cm4gXy50b0xvd2VyKG5hbWUpLmVuZHNXaXRoKERFRkFVTFRfRVhUKSA/IG5hbWUgOiBgJHtuYW1lfSR7REVGQVVMVF9FWFR9YDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5TWVkaWFQcm9qZWN0aW9uUmVjb3JkaW5nSXNTdXBwb3J0ZWQgKGFkYikge1xuICBjb25zdCBhcGlMZXZlbCA9IGF3YWl0IGFkYi5nZXRBcGlMZXZlbCgpO1xuICBpZiAoYXBpTGV2ZWwgPCBNSU5fQVBJX0xFVkVMKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBNZWRpYSBwcm9qZWN0aW9uLWJhc2VkIHJlY29yZGluZyBpcyBub3QgYXZhaWxhYmxlIG9uIEFQSSBMZXZlbCAke2FwaUxldmVsfS4gYCArXG4gICAgICBgTWluaW11bSByZXF1aXJlZCBBUEkgTGV2ZWwgaXMgJHtNSU5fQVBJX0xFVkVMfS5gKTtcbiAgfVxufVxuXG5cbmNsYXNzIE1lZGlhUHJvamVjdGlvblJlY29yZGVyIHtcbiAgY29uc3RydWN0b3IgKGFkYikge1xuICAgIHRoaXMuYWRiID0gYWRiO1xuICB9XG5cbiAgYXN5bmMgaXNSdW5uaW5nICgpIHtcbiAgICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLmFkYi5zaGVsbChbXG4gICAgICAnZHVtcHN5cycsICdhY3Rpdml0eScsICdzZXJ2aWNlcycsIFJFQ09SRElOR19TRVJWSUNFX05BTUVcbiAgICBdKTtcbiAgICByZXR1cm4gc3Rkb3V0LmluY2x1ZGVzKFJFQ09SRElOR19TRVJWSUNFX05BTUUpO1xuICB9XG5cbiAgYXN5bmMgc3RhcnQgKG9wdHMgPSB7fSkge1xuICAgIGlmIChhd2FpdCB0aGlzLmlzUnVubmluZygpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5jbGVhbnVwKCk7XG4gICAgY29uc3Qge1xuICAgICAgZmlsZW5hbWUsXG4gICAgICBtYXhEdXJhdGlvblNlYyxcbiAgICAgIHByaW9yaXR5LFxuICAgICAgcmVzb2x1dGlvbixcbiAgICB9ID0gb3B0cztcbiAgICBjb25zdCBhcmdzID0gW1xuICAgICAgJ2FtJywgJ3N0YXJ0JyxcbiAgICAgICctbicsIFJFQ09SRElOR19BQ1RJVklUWV9OQU1FLFxuICAgICAgJy1hJywgUkVDT1JESU5HX0FDVElPTl9TVEFSVCxcbiAgICBdO1xuICAgIGlmIChmaWxlbmFtZSkge1xuICAgICAgYXJncy5wdXNoKCctLWVzJywgJ2ZpbGVuYW1lJywgZmlsZW5hbWUpO1xuICAgIH1cbiAgICBpZiAobWF4RHVyYXRpb25TZWMpIHtcbiAgICAgIGFyZ3MucHVzaCgnLS1lcycsICdtYXhfZHVyYXRpb25fc2VjJywgYCR7bWF4RHVyYXRpb25TZWN9YCk7XG4gICAgfVxuICAgIGlmIChwcmlvcml0eSkge1xuICAgICAgYXJncy5wdXNoKCctLWVzJywgJ3ByaW9yaXR5JywgcHJpb3JpdHkpO1xuICAgIH1cbiAgICBpZiAocmVzb2x1dGlvbikge1xuICAgICAgYXJncy5wdXNoKCctLWVzJywgJ3Jlc29sdXRpb24nLCByZXNvbHV0aW9uKTtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5hZGIuc2hlbGwoYXJncyk7XG4gICAgYXdhaXQgbmV3IEIoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmICghYXdhaXQgdGhpcy5pc1J1bm5pbmcoKSkge1xuICAgICAgICAgIHJldHVybiByZWplY3QobmV3IEVycm9yKFxuICAgICAgICAgICAgYFRoZSBtZWRpYSBwcm9qZWN0aW9uIHJlY29yZGluZyBpcyBub3QgcnVubmluZyBhZnRlciAke1JFQ09SRElOR19TVEFSVFVQX1RJTUVPVVRfTVN9bXMuIGAgK1xuICAgICAgICAgICAgYFBsZWFzZSBjaGVjayB0aGUgbG9nY2F0IG91dHB1dCBmb3IgbW9yZSBkZXRhaWxzLmBcbiAgICAgICAgICApKTtcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9LCBSRUNPUkRJTkdfU1RBUlRVUF9USU1FT1VUX01TKTtcbiAgICB9KTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGFzeW5jIGNsZWFudXAgKCkge1xuICAgIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFtgcm0gLWYgJHtSRUNPUkRJTkdTX1JPT1R9LypgXSk7XG4gIH1cblxuICBhc3luYyBwdWxsUmVjZW50ICgpIHtcbiAgICBjb25zdCByZWNvcmRpbmdzID0gYXdhaXQgdGhpcy5hZGIubHMoUkVDT1JESU5HU19ST09ULCBbJy10ciddKTtcbiAgICBpZiAoXy5pc0VtcHR5KHJlY29yZGluZ3MpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBkc3RQYXRoID0gcGF0aC5qb2luKGF3YWl0IHRlbXBEaXIub3BlbkRpcigpLCByZWNvcmRpbmdzWzBdKTtcbiAgICBhd2FpdCB0aGlzLmFkYi5wdWxsKGAke1JFQ09SRElOR1NfUk9PVH0vJHtyZWNvcmRpbmdzWzBdfWAsIGRzdFBhdGgpO1xuICAgIHJldHVybiBkc3RQYXRoO1xuICB9XG5cbiAgYXN5bmMgc3RvcCAoKSB7XG4gICAgaWYgKCFhd2FpdCB0aGlzLmlzUnVubmluZygpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5hZGIuc2hlbGwoW1xuICAgICAgJ2FtJywgJ3N0YXJ0JyxcbiAgICAgICctbicsIFJFQ09SRElOR19BQ1RJVklUWV9OQU1FLFxuICAgICAgJy1hJywgUkVDT1JESU5HX0FDVElPTl9TVE9QLFxuICAgIF0pO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFzeW5jICgpID0+ICEoYXdhaXQgdGhpcy5pc1J1bm5pbmcoKSksIHtcbiAgICAgICAgd2FpdE1zOiBSRUNPUkRJTkdfU1RPUF9USU1FT1VUX01TLFxuICAgICAgICBpbnRlcnZhbE1zOiA1MDAsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBUaGUgYXR0ZW1wdCB0byBzdG9wIHRoZSBjdXJyZW50IG1lZGlhIHByb2plY3Rpb24gcmVjb3JkaW5nIHRpbWVkIG91dCBhZnRlciBgICtcbiAgICAgICAgYCR7UkVDT1JESU5HX1NUT1BfVElNRU9VVF9NU31tc2BcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG59XG5cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBTdGFydFJlY29yZGluZ09wdGlvbnNcbiAqXG4gKiBAcHJvcGVydHkge3N0cmluZz99IHJlc29sdXRpb24gTWF4aW11bSBzdXBwb3J0ZWQgcmVzb2x1dGlvbiBvbi1kZXZpY2UgKERldGVjdGVkXG4gKiBhdXRvbWF0aWNhbGx5IGJ5IHRoZSBhcHAgaXRzZWxmKSwgd2hpY2ggdXN1YWxseSBlcXVhbHMgdG8gRnVsbCBIRCAxOTIweDEwODAgb24gbW9zdFxuICogcGhvbmVzIGhvd2V2ZXIgeW91IGNhbiBjaGFuZ2UgaXQgdG8gZm9sbG93aW5nIHN1cHBvcnRlZCByZXNvbHV0aW9uc1xuICogYXMgd2VsbDogXCIxOTIweDEwODBcIiwgXCIxMjgweDcyMFwiLCBcIjcyMHg0ODBcIiwgXCIzMjB4MjQwXCIsIFwiMTc2eDE0NFwiLlxuICogQHByb3BlcnR5IHtudW1iZXI/fSBtYXhEdXJhdGlvblNlYyBbOTAwXSBEZWZhdWx0IHZhbHVlOiA5MDAgc2Vjb25kcyB3aGljaCBtZWFuc1xuICogbWF4aW11bSBhbGxvd2VkIGR1cmF0aW9uIGlzIDE1IG1pbnV0ZSwgeW91IGNhbiBpbmNyZWFzZSBpdCBpZiB5b3VyIHRlc3QgdGFrZXNcbiAqIGxvbmdlciB0aGFuIHRoYXQuXG4gKiBAcHJvcGVydHkge3N0cmluZz99IHByaW9yaXR5IFtoaWdoXSBNZWFucyByZWNvcmRpbmcgdGhyZWFkIHByaW9yaXR5IGlzIG1heGltdW1cbiAqIGhvd2V2ZXIgaWYgeW91IGZhY2UgcGVyZm9ybWFuY2UgZHJvcHMgZHVyaW5nIHRlc3Rpbmcgd2l0aCByZWNvcmRpbmcgZW5hYmxlZCwgeW91XG4gKiBjYW4gcmVkdWNlIHJlY29yZGluZyBwcmlvcml0eSB0byBcIm5vcm1hbFwiIG9yIFwibG93XCIuXG4gKiBAcHJvcGVydHkge3N0cmluZz99IGZpbGVuYW1lIFlvdSBjYW4gdHlwZSByZWNvcmRpbmcgdmlkZW8gZmlsZSBuYW1lIGFzIHlvdSB3YW50LFxuICogYnV0IHJlY29yZGluZyBjdXJyZW50bHkgc3VwcG9ydHMgb25seSBcIm1wNFwiIGZvcm1hdCBzbyB5b3VyIGZpbGVuYW1lIG11c3QgZW5kIHdpdGggXCIubXA0XCIuXG4gKiBBbiBpbnZhbGlkIGZpbGUgbmFtZSB3aWxsIGZhaWwgdG8gc3RhcnQgdGhlIHJlY29yZGluZy5cbiAqIElmIG5vdCBwcm92aWRlZCB0aGVuIHRoZSBjdXJyZW50IHRpbWVzdGFtcCB3aWxsIGJlIHVzZWQgYXMgZmlsZSBuYW1lLlxuICovXG5cbi8qKlxuICogUmVjb3JkIHRoZSBkaXNwbGF5IG9mIGEgcmVhbCBkZXZpY2VzIHJ1bm5pbmcgQW5kcm9pZCAxMCAoQVBJIGxldmVsIDI5KSBhbmQgaGlnaGVyLlxuICogVGhlIHNjcmVlbiBhY3Rpdml0eSBpcyByZWNvcmRlZCB0byBhIE1QRUctNCBmaWxlLiBBdWRpbyBpcyBhbHNvIHJlY29yZGVkIGJ5IGRlZmF1bHRcbiAqIChvbmx5IGZvciBhcHBzIHRoYXQgYWxsb3cgaXQgaW4gdGhlaXIgbWFuaWZlc3RzKS5cbiAqIElmIGFub3RoZXIgcmVjb3JkaW5nIGhhcyBiZWVuIGFscmVhZHkgc3RhcnRlZCB0aGVuIHRoZSBjb21tYW5kIHdpbGwgZXhpdCBzaWxlbnRseS5cbiAqIFRoZSBwcmV2aW91c2x5IHJlY29yZGVkIHZpZGVvIGZpbGUgaXMgZGVsZXRlZCB3aGVuIGEgbmV3IHJlY29yZGluZyBzZXNzaW9uIGlzIHN0YXJ0ZWQuXG4gKiBSZWNvcmRpbmcgY29udGludWVzIGl0IGlzIHN0b3BwZWQgZXhwbGljaXRseSBvciB1bnRpbCB0aGUgdGltZW91dCBoYXBwZW5zLlxuICpcbiAqIEBwYXJhbSB7P1N0YXJ0UmVjb3JkaW5nT3B0aW9uc30gb3B0aW9ucyBBdmFpbGFibGUgb3B0aW9ucy5cbiAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIGEgbmV3IHJlY29yZGluZyBoYXMgc3VjY2Vzc2Z1bGx5IHN0YXJ0ZWQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgcmVjb3JkaW5nIGhhcyBmYWlsZWQgdG8gc3RhcnQgb3IgaXMgbm90IHN1cHBvcnRlZCBvbiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKi9cbmNvbW1hbmRzLm1vYmlsZVN0YXJ0TWVkaWFQcm9qZWN0aW9uUmVjb3JkaW5nID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlU3RhcnRNZWRpYVByb2plY3Rpb25SZWNvcmRpbmcgKG9wdGlvbnMgPSB7fSkge1xuICBhd2FpdCB2ZXJpZnlNZWRpYVByb2plY3Rpb25SZWNvcmRpbmdJc1N1cHBvcnRlZCh0aGlzLmFkYik7XG5cbiAgY29uc3Qge3Jlc29sdXRpb24sIHByaW9yaXR5LCBtYXhEdXJhdGlvblNlYywgZmlsZW5hbWV9ID0gb3B0aW9ucztcbiAgY29uc3QgcmVjb3JkZXIgPSBuZXcgTWVkaWFQcm9qZWN0aW9uUmVjb3JkZXIodGhpcy5hZGIpO1xuICBjb25zdCBmbmFtZSA9IGFkanVzdE1lZGlhRXh0ZW5zaW9uKGZpbGVuYW1lIHx8IG1vbWVudCgpLmZvcm1hdChERUZBVUxUX0ZJTEVOQU1FX0ZPUk1BVCkpO1xuICBjb25zdCBkaWRTdGFydCA9IGF3YWl0IHJlY29yZGVyLnN0YXJ0KHtcbiAgICByZXNvbHV0aW9uLFxuICAgIHByaW9yaXR5LFxuICAgIG1heER1cmF0aW9uU2VjLFxuICAgIGZpbGVuYW1lOiBmbmFtZSxcbiAgfSk7XG4gIGlmIChkaWRTdGFydCkge1xuICAgIHRoaXMubG9nLmluZm8oYEEgbmV3IG1lZGlhIHByb2plY3Rpb24gcmVjb3JkaW5nICcke2ZuYW1lfScgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IHN0YXJ0ZWRgKTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLmxvZy5pbmZvKCdBbm90aGVyIG1lZGlhIHByb2plY3Rpb24gcmVjb3JkaW5nIGlzIGFscmVhZHkgaW4gcHJvZ3Jlc3MuIFRoZXJlIGlzIG5vdGhpbmcgdG8gc3RhcnQnKTtcbiAgfVxuICByZXR1cm4gZGlkU3RhcnQ7XG59O1xuXG4vKipcbiAqIENoZWNrcyBpZiBhIG1lZGlhIHByb2plY3Rpb24tYmFzZWQgcmVjb3JkaW5nIGlzIGN1cnJlbnRseSBydW5uaW5nLlxuICpcbiAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIGEgcmVjb3JkaW5nIGlzIGluIHByb2dyZXNzLlxuICogQHRocm93cyB7RXJyb3J9IElmIGEgcmVjb3JkaW5nIGlzIG5vdCBzdXBwb3J0ZWQgb24gdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICovXG5jb21tYW5kcy5tb2JpbGVJc01lZGlhUHJvamVjdGlvblJlY29yZGluZ1J1bm5pbmcgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVJc01lZGlhUHJvamVjdGlvblJlY29yZGluZ1J1bm5pbmcgKCkge1xuICBhd2FpdCB2ZXJpZnlNZWRpYVByb2plY3Rpb25SZWNvcmRpbmdJc1N1cHBvcnRlZCh0aGlzLmFkYik7XG5cbiAgY29uc3QgcmVjb3JkZXIgPSBuZXcgTWVkaWFQcm9qZWN0aW9uUmVjb3JkZXIodGhpcy5hZGIpO1xuICByZXR1cm4gYXdhaXQgcmVjb3JkZXIuaXNSdW5uaW5nKCk7XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFN0b3BSZWNvcmRpbmdPcHRpb25zXG4gKlxuICogQHByb3BlcnR5IHtzdHJpbmc/fSByZW1vdGVQYXRoIFRoZSBwYXRoIHRvIHRoZSByZW1vdGUgbG9jYXRpb24sIHdoZXJlIHRoZSByZXN1bHRpbmcgdmlkZW8gc2hvdWxkIGJlIHVwbG9hZGVkLlxuICogVGhlIGZvbGxvd2luZyBwcm90b2NvbHMgYXJlIHN1cHBvcnRlZDogaHR0cC9odHRwcywgZnRwLlxuICogTnVsbCBvciBlbXB0eSBzdHJpbmcgdmFsdWUgKHRoZSBkZWZhdWx0IHNldHRpbmcpIG1lYW5zIHRoZSBjb250ZW50IG9mIHJlc3VsdGluZ1xuICogZmlsZSBzaG91bGQgYmUgZW5jb2RlZCBhcyBCYXNlNjQgYW5kIHBhc3NlZCBhcyB0aGUgZW5kcG9vbnQgcmVzcG9uc2UgdmFsdWUuXG4gKiBBbiBleGNlcHRpb24gd2lsbCBiZSB0aHJvd24gaWYgdGhlIGdlbmVyYXRlZCBtZWRpYSBmaWxlIGlzIHRvbyBiaWcgdG9cbiAqIGZpdCBpbnRvIHRoZSBhdmFpbGFibGUgcHJvY2VzcyBtZW1vcnkuXG4gKiBAcHJvcGVydHkge3N0cmluZz99IHVzZXIgVGhlIG5hbWUgb2YgdGhlIHVzZXIgZm9yIHRoZSByZW1vdGUgYXV0aGVudGljYXRpb24uXG4gKiBAcHJvcGVydHkge3N0cmluZz99IHBhc3MgVGhlIHBhc3N3b3JkIGZvciB0aGUgcmVtb3RlIGF1dGhlbnRpY2F0aW9uLlxuICogQHByb3BlcnR5IHtzdHJpbmc/fSBtZXRob2QgVGhlIGh0dHAgbXVsdGlwYXJ0IHVwbG9hZCBtZXRob2QgbmFtZS4gVGhlICdQVVQnIG9uZSBpcyB1c2VkIGJ5IGRlZmF1bHQuXG4gKiBAcHJvcGVydHkge09iamVjdD99IGhlYWRlcnMgQWRkaXRpb25hbCBoZWFkZXJzIG1hcHBpbmcgZm9yIG11bHRpcGFydCBodHRwKHMpIHVwbG9hZHNcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nP30gZmlsZUZpZWxkTmFtZSBbZmlsZV0gVGhlIG5hbWUgb2YgdGhlIGZvcm0gZmllbGQsIHdoZXJlIHRoZSBmaWxlIGNvbnRlbnQgQkxPQiBzaG91bGQgYmUgc3RvcmVkIGZvclxuICogaHR0cChzKSB1cGxvYWRzXG4gKiBAcHJvcGVydHkge09iamVjdHxBcnJheTxQYWlyPj99IGZvcm1GaWVsZHMgQWRkaXRpb25hbCBmb3JtIGZpZWxkcyBmb3IgbXVsdGlwYXJ0IGh0dHAocykgdXBsb2Fkc1xuICovXG5cbi8qKlxuICogU3RvcCBhIG1lZGlhIHByb2plY3Rpb24tYmFzZWQgcmVjb3JkaW5nLlxuICogSWYgbm8gcmVjb3JkaW5nIGhhcyBiZWVuIHN0YXJ0ZWQgYmVmb3JlIHRoZW4gYW4gZXJyb3IgaXMgdGhyb3duLlxuICogSWYgdGhlIHJlY29yZGluZyBoYXMgYmVlbiBhbHJlYWR5IGZpbmlzaGVkIGJlZm9yZSB0aGlzIEFQSSBoYXMgYmVlbiBjYWxsZWRcbiAqIHRoZW4gdGhlIG1vc3QgcmVjZW50IHJlY29yZGVkIGZpbGUgaXMgcmV0dXJuZWQuXG4gKlxuICogQHBhcmFtIHs/U3RvcFJlY29yZGluZ09wdGlvbnN9IG9wdGlvbnMgQXZhaWxhYmxlIG9wdGlvbnMuXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBCYXNlNjQtZW5jb2RlZCBjb250ZW50IG9mIHRoZSByZWNvcmRlZCBtZWRpYSBmaWxlIGlmICdyZW1vdGVQYXRoJ1xuICogcGFyYW1ldGVyIGlzIGZhbHN5IG9yIGFuIGVtcHR5IHN0cmluZy5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgc3RvcHBpbmcgYSByZWNvcmRpbmcsXG4gKiBmZXRjaGluZyB0aGUgY29udGVudCBvZiB0aGUgcmVtb3RlIG1lZGlhIGZpbGUsXG4gKiBvciBpZiBhIHJlY29yZGluZyBpcyBub3Qgc3VwcG9ydGVkIG9uIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqL1xuY29tbWFuZHMubW9iaWxlU3RvcE1lZGlhUHJvamVjdGlvblJlY29yZGluZyA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVN0b3BNZWRpYVByb2plY3Rpb25SZWNvcmRpbmcgKG9wdGlvbnMgPSB7fSkge1xuICBhd2FpdCB2ZXJpZnlNZWRpYVByb2plY3Rpb25SZWNvcmRpbmdJc1N1cHBvcnRlZCh0aGlzLmFkYik7XG5cbiAgY29uc3QgcmVjb3JkZXIgPSBuZXcgTWVkaWFQcm9qZWN0aW9uUmVjb3JkZXIodGhpcy5hZGIpO1xuICBpZiAoYXdhaXQgcmVjb3JkZXIuc3RvcCgpKSB7XG4gICAgdGhpcy5sb2cuaW5mbygnU3VjY2Vzc2Z1bGx5IHN0b3BwZWQgYSBtZWRpYSBwcm9qZWN0aW9uIHJlY29yZGluZy4gUHVsbGluZyB0aGUgcmVjb3JkZWQgbWVkaWEnKTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLmxvZy5pbmZvKCdNZWRpYSBwcm9qZWN0aW9uIHJlY29yZGluZyBpcyBub3QgcnVubmluZy4gVGhlcmUgaXMgbm90aGluZyB0byBzdG9wJyk7XG4gIH1cbiAgY29uc3QgcmVjZW50UmVjb3JkaW5nUGF0aCA9IGF3YWl0IHJlY29yZGVyLnB1bGxSZWNlbnQoKTtcbiAgaWYgKCFyZWNlbnRSZWNvcmRpbmdQYXRoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBObyByZWNlbnQgbWVkaWEgcHJvamVjdGlvbiByZWNvcmRpbmcgaGF2ZSBiZWVuIGZvdW5kLiBEaWQgeW91IHN0YXJ0IGFueT9gKTtcbiAgfVxuXG4gIGNvbnN0IHtyZW1vdGVQYXRofSA9IG9wdGlvbnM7XG4gIGlmIChfLmlzRW1wdHkocmVtb3RlUGF0aCkpIHtcbiAgICBjb25zdCB7c2l6ZX0gPSBhd2FpdCBmcy5zdGF0KHJlY2VudFJlY29yZGluZ1BhdGgpO1xuICAgIHRoaXMubG9nLmRlYnVnKGBUaGUgc2l6ZSBvZiB0aGUgcmVzdWx0aW5nIG1lZGlhIHByb2plY3Rpb24gcmVjb3JkaW5nIGlzICR7dXRpbC50b1JlYWRhYmxlU2l6ZVN0cmluZyhzaXplKX1gKTtcbiAgfVxuICB0cnkge1xuICAgIHJldHVybiBhd2FpdCB1cGxvYWRSZWNvcmRlZE1lZGlhKHJlY2VudFJlY29yZGluZ1BhdGgsIHJlbW90ZVBhdGgsIG9wdGlvbnMpO1xuICB9IGZpbmFsbHkge1xuICAgIGF3YWl0IGZzLnJpbXJhZihwYXRoLmRpcm5hbWUocmVjZW50UmVjb3JkaW5nUGF0aCkpO1xuICB9XG59O1xuXG5cbmV4cG9ydCB7IGNvbW1hbmRzIH07XG5leHBvcnQgZGVmYXVsdCBjb21tYW5kcztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBLE1BQU1BLFFBQVEsR0FBRyxDQUFDLENBQUM7O0FBQUM7QUFHcEIsTUFBTUMsV0FBVyxHQUFHLE1BQU07QUFDMUIsTUFBTUMsNEJBQTRCLEdBQUcsQ0FBQyxHQUFHLElBQUk7QUFDN0MsTUFBTUMseUJBQXlCLEdBQUcsQ0FBQyxHQUFHLElBQUk7QUFDMUMsTUFBTUMsYUFBYSxHQUFHLEVBQUU7QUFDeEIsTUFBTUMsc0JBQXNCLEdBQUksR0FBRUMsc0NBQXVCLDRCQUEyQjtBQUNwRixNQUFNQyx1QkFBdUIsR0FBSSxHQUFFRCxzQ0FBdUIsOEJBQTZCO0FBQ3ZGLE1BQU1FLHNCQUFzQixHQUFJLEdBQUVGLHNDQUF1Qix5QkFBd0I7QUFDakYsTUFBTUcscUJBQXFCLEdBQUksR0FBRUgsc0NBQXVCLHdCQUF1QjtBQUMvRSxNQUFNSSxlQUFlLEdBQUksb0NBQW1DSixzQ0FBdUIsUUFBTztBQUMxRixNQUFNSyx1QkFBdUIsR0FBRyxxQkFBcUI7QUFHckQsZUFBZUMsbUJBQW1CLENBQUVDLFNBQVMsRUFBRUMsVUFBVSxHQUFHLElBQUksRUFBRUMsYUFBYSxHQUFHLENBQUMsQ0FBQyxFQUFFO0VBQ3BGLElBQUlDLGVBQUMsQ0FBQ0MsT0FBTyxDQUFDSCxVQUFVLENBQUMsRUFBRTtJQUN6QixPQUFPLENBQUMsTUFBTUksYUFBSSxDQUFDQyxnQkFBZ0IsQ0FBQ04sU0FBUyxDQUFDLEVBQUVPLFFBQVEsRUFBRTtFQUM1RDtFQUVBLE1BQU07SUFBQ0MsSUFBSTtJQUFFQyxJQUFJO0lBQUVDLE1BQU07SUFBRUMsT0FBTztJQUFFQyxhQUFhO0lBQUVDO0VBQVUsQ0FBQyxHQUFHWCxhQUFhO0VBQzlFLE1BQU1ZLE9BQU8s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